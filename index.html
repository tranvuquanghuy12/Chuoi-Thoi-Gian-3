<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Buổi 3: Các phương pháp Vectơ tự hồi quy (Vector Autoregressive Methods)</title>
    <style>

    :root { --primary: #f59e0b; --text: #451a03; }
    html { scroll-behavior: smooth; }
    body { font-family: "Quicksand", sans-serif; line-height: 1.8; color: var(--text); max-width: 1100px; margin: 0 auto; padding: 3rem 5%; background: #fffcf2; }
    article { background: #ffffff; padding: 50px; border-radius: 30px; border: 1px solid #fef3c7; }
    h1 { font-size: 2.8rem; color: #92400e; text-align: center; margin-bottom: 3rem; }
    h2 { font-size: 1.7rem; color: #b45309; margin-top: 3rem; background: #fef3c7; padding: 10px 25px; border-radius: 15px; display: inline-block; }
    
    img { 
      max-width: 100% !important; 
      height: auto !important; 
      object-fit: contain !important;
      border-radius: 20px; 
      box-shadow: 0 10px 25px rgba(245, 158, 11, 0.1); 
      margin: 3rem auto; 
      display: block;
      border: 4px solid #fff;
    }

    mjx-container[display="true"], .math.display {
      background: #fffbeb;
      padding: 1.5rem;
      border-radius: 20px;
      border: 2px dashed #fde68a;
      margin: 2rem 0;
    }
    mjx-container:not([display="true"]), .math:not(.display) {
      background: transparent !important;
      border: none !important;
      padding: 0 !important;
      display: inline-block;
      margin: 0 !important;
      box-shadow: none !important;
    }

    .table-container {
      width: 100%;
      overflow-x: auto;
      margin: 2rem 0;
      background: #fff;
      border: 3px solid #fef3c7;
      border-radius: 25px;
    }
    table { width: 100%; border-collapse: collapse; }
    th { background: #fffbeb; color: #92400e; padding: 1.25rem; }
    td { padding: 1.25rem; border-bottom: 1px solid #fffbeb; text-align: center; }

    pre { background: #2d3748; color: #fff; padding: 25px; border-radius: 20px; }
    .toc { background: #fffbeb; border: 3px solid #f59e0b; padding: 2rem; border-radius: 25px; }
  
    </style>
    
  <script>
  window.MathJax = {
    tex: {
      inlineMath: [['$', '$'], ['\\(', '\\)']],
      displayMath: [['$$', '$$'], ['\\[', '\\]']],
      processEscapes: true,
      processEnvironments: true,
      processRefs: true,
      tags: 'ams'
    },
    options: {
      renderActions: {
        addMenu: []
      },
      ignoreHtmlClass: 'tex2jax_ignore',
      processHtmlClass: 'tex2jax_process'
    },
    chtml: {
      displayAlign: 'center',
      displayIndent: '0'
    }
  };
  </script>
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

</head>
<body class="tex2jax_process">
    <article class="tex2jax_process">
<section class="tex2jax_ignore mathjax_ignore tex2jax_process display" id="chuong-3-cac-phuong-phap-vecto-tu-hoi-quy-vector-autoregressive-methods">
<h1 id="buoi-3-cac-phuong-phap-vecto-tu-hoi-quy-vector-aut-0">Buổi 3: Các phương pháp Vectơ tự hồi quy (Vector Autoregressive Methods)</h1>

    <nav class="toc">
        <div class="toc-title">Mục lục</div>
        <ul>
            <li class="toc-level-1"><a href="#buoi-3-cac-phuong-phap-vecto-tu-hoi-quy-vector-aut-0">Buổi 3: Các phương pháp Vectơ tự hồi quy (Vector Autoregressive Methods)</a></li><li class="toc-level-2"><a href="#mo-hinh-chuoi-thoi-gian-da-bien-1">Mô hình chuỗi thời gian đa biến</a></li><li class="toc-level-3"><a href="#dinh-nghia-chuoi-thoi-gian-don-bien-va-da-bien-2">Định nghĩa: Chuỗi thời gian đơn biến và đa biến</a></li><li class="toc-level-3"><a href="#vi-du-1-chuoi-thoi-gian-da-bien-3">Ví dụ 1: Chuỗi thời gian đa biến</a></li><li class="toc-level-3"><a href="#kien-thuc-nen-tang-4">Kiến thức nền tảng</a></li><li class="toc-level-2"><a href="#cac-mo-hinh-vecto-tu-hoi-quy-var--5">Các mô hình Vectơ tự hồi quy (VAR)</a></li><li class="toc-level-3"><a href="#mo-hinh-var-1--6">Mô hình VAR(1)</a></li><li class="toc-level-3"><a href="#mo-hinh-var-p--7">Mô hình VAR(p)</a></li><li class="toc-level-3"><a href="#xac-dinh-mo-hinh-var-lua-chon-bac-p-8">Xác định mô hình VAR: Lựa chọn bậc p</a></li><li class="toc-level-2"><a href="#xay-dung-mo-hinh-var-9">Xây dựng mô hình VAR</a></li><li class="toc-level-3"><a href="#vi-du-2-du-bao-du-lieu-chat-luong-khong-khi-co-no2-10">Ví dụ 2: Dự báo dữ liệu chất lượng không khí (CO, NO2 và RH)</a></li><li class="toc-level-2"><a href="#phan-tich-var-cau-truc-11">Phân tích VAR cấu trúc</a></li><li class="toc-level-3"><a href="#ham-phan-ung-xung-impulse-response-function-irf--12">Hàm phản ứng xung (Impulse Response Function - IRF)</a></li><li class="toc-level-3"><a href="#phan-ra-phuong-sai-sai-so-du-bao-forecast-error-va-13">Phân rã phương sai sai số dự báo (Forecast Error Variance Decomposition – FEVD)</a></li><li class="toc-level-3"><a href="#vi-du-3-du-bao-du-lieu-khi-hau-jena-14">Ví dụ 3: Dự báo dữ liệu khí hậu Jena</a></li>
        </ul>
    </nav>

    
<p>Biên soạn bởi: Maria Eloisa Ventura</p>
<p>Trước đây, chúng ta đã giới thiệu các phương pháp cổ điển trong việc dự báo chuỗi thời gian đơn biến như mô hình ARIMA (tự hồi quy tích hợp trung bình động) và mô hình hồi quy tuyến tính đơn giản. Chúng ta đã biết rằng tính dừng (stationarity) là một điều kiện cần thiết khi sử dụng ARIMA, trong khi điều kiện này không bắt buộc khi sử dụng mô hình hồi quy tuyến tính. Trong nội dung này, chúng ta mở rộng bài toán dự báo sang một khuôn khổ tổng quát hơn, nơi chúng ta xử lý <strong>chuỗi thời gian đa biến (multivariate time series)</strong> – loại chuỗi thời gian có nhiều hơn một biến phụ thuộc vào thời gian. Cụ thể hơn, chúng ta sẽ giới thiệu các mô hình <strong>Vectơ tự hồi quy (VAR)</strong> và chỉ ra cách chúng được sử dụng trong việc dự báo chuỗi thời gian đa biến.</p>
<section id="mo-hinh-chuoi-thoi-gian-da-bien" class="tex2jax_process display">
<h2 id="mo-hinh-chuoi-thoi-gian-da-bien-1">Mô hình chuỗi thời gian đa biến</h2>
<p>Như đã trình bày trong các buổi trước, một trong những ưu điểm chính của việc sử dụng các phương pháp đơn biến đơn giản (ví dụ: ARIMA) là khả năng dự báo các giá trị tương lai của một biến chỉ bằng cách sử dụng các giá trị quá khứ của chính nó. Tuy nhiên, chúng ta biết rằng hầu hết, nếu không muốn nói là tất cả, các biến mà chúng ta quan sát thực tế đều phụ thuộc vào các biến khác. Phần lớn thời gian, thông tin mà chúng ta thu thập được bị giới hạn bởi khả năng đo lường các biến mục tiêu. Ví dụ, nếu muốn nghiên cứu thời tiết ở một thành phố cụ thể, chúng ta có thể đo nhiệt độ, độ ẩm và lượng mưa theo thời gian. Nhưng nếu chỉ có một chiếc nhiệt kế, chúng ta sẽ chỉ thu thập được dữ liệu về nhiệt độ, điều này làm giảm tập dữ liệu xuống thành chuỗi thời gian đơn biến một cách hiệu quả.</p>
<p>Giờ đây, trong trường hợp chúng ta có nhiều chuỗi thời gian (các phép đo dọc của nhiều hơn một biến), chúng ta thực sự có thể sử dụng các mô hình chuỗi thời gian đa biến để hiểu mối quan hệ của các biến khác nhau theo thời gian. Bằng cách tận dụng thông tin bổ sung có sẵn từ các chuỗi liên quan, các mô hình này thường có thể cung cấp các dự báo tốt hơn so với các mô hình chuỗi thời gian đơn biến.</p>
<p>Trong phần này, chúng ta sẽ đề cập đến những thông tin nền tảng cần thiết để hiểu về Mô hình Vectơ tự hồi quy (Vector Autoregressive Models - VAR), một lớp của mô hình chuỗi thời gian đa biến, bằng cách sử dụng một khuôn khổ tương tự như chuỗi thời gian đơn biến đã được trình bày trong các buổi trước và mở rộng nó sang trường hợp đa biến.</p>
<section id="dinh-nghia-chuoi-thoi-gian-don-bien-va-da-bien">
<h3 id="dinh-nghia-chuoi-thoi-gian-don-bien-va-da-bien-2">Định nghĩa: Chuỗi thời gian đơn biến và đa biến</h3>
<p>Chuỗi thời gian có thể là đơn biến hoặc đa biến. Thuật ngữ chuỗi thời gian đơn biến bao gồm các quan sát đơn lẻ được ghi lại tuần tự theo các khoảng thời gian bằng nhau. Khi xử lý mô hình chuỗi thời gian đơn biến (ví dụ: ARIMA), chúng ta thường đề cập đến một mô hình chứa các giá trị trễ của chính nó đóng vai trò là biến độc lập.</p>
<p>Mặt khác, một <strong>chuỗi thời gian đa biến (multivariate time series)</strong> có nhiều hơn một biến phụ thuộc vào thời gian. Đối với một quá trình đa biến, nhiều chuỗi thời gian liên quan được quan sát đồng thời theo thời gian. Là một phần mở rộng của trường hợp đơn biến, mô hình chuỗi thời gian đa biến bao gồm hai hoặc nhiều biến đầu vào, đồng thời tận dụng mối quan hệ tương hỗ giữa các biến chuỗi thời gian khác nhau đó.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">statsmodels.tsa</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">tsa</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">statsmodels.tsa.vector_ar.var_model</span><span class="w"> </span><span class="kn">import</span> <span class="n">VAR</span><span class="p">,</span> <span class="n">FEVD</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">statsmodels.tsa.arima_model</span><span class="w"> </span><span class="kn">import</span> <span class="n">ARIMA</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">statsmodels.tsa.stattools</span><span class="w"> </span><span class="kn">import</span> <span class="n">acf</span><span class="p">,</span> <span class="n">adfuller</span><span class="p">,</span> <span class="n">ccf</span><span class="p">,</span> <span class="n">ccovf</span><span class="p">,</span> <span class="n">kpss</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">statsmodels.graphics.tsaplots</span><span class="w"> </span><span class="kn">import</span> <span class="n">plot_acf</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">mvts_utils</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">utils</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">seaborn</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sns</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">"ignore"</span><span class="p">)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">'display.max_rows'</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">'display.max_columns'</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

<span class="o">%</span><span class="k">load_ext</span> autoreload
<span class="o">%</span><span class="k">autoreload</span> 2
</pre></div>
</div>
</div>
</div>
</section>
<section id="vi-du-1-chuoi-thoi-gian-da-bien">
<h3 id="vi-du-1-chuoi-thoi-gian-da-bien-3">Ví dụ 1: Chuỗi thời gian đa biến</h3>
<section id="a-du-lieu-chat-luong-khong-khi-tu-uci">
<h4>A. Dữ liệu chất lượng không khí từ UCI</h4>
<p>Tập dữ liệu này chứa các phép đo trung bình hàng giờ thu được từ Thiết bị đa cảm biến hóa học chất lượng không khí (Air Quality Chemical Multisensor Device), được đặt tại thực địa của một khu vực bị ô nhiễm tại một thành phố của Ý. Tập dữ liệu có thể được tải xuống tại <strong><a class="reference external" href="https://archive.ics.uci.edu/ml/datasets/Air+Quality#">đây</a></strong>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">aq_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="s2">"../data/AirQualityUCI/AirQualityUCI.xlsx"</span><span class="p">,</span> <span class="n">parse_dates</span><span class="o">=</span><span class="p">[[</span><span class="s1">'Date'</span><span class="p">,</span> <span class="s1">'Time'</span><span class="p">]])</span>\
            <span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">'Date_Time'</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="o">-</span><span class="mi">200</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span><span class="o">.</span><span class="n">interpolate</span><span class="p">()</span>
<span class="n">aq_df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<div class="table-container"><table class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>CO(GT)</th>
      <th>PT08.S1(CO)</th>
      <th>NMHC(GT)</th>
      <th>C6H6(GT)</th>
      <th>PT08.S2(NMHC)</th>
      <th>NOx(GT)</th>
      <th>PT08.S3(NOx)</th>
      <th>NO2(GT)</th>
      <th>PT08.S4(NO2)</th>
      <th>PT08.S5(O3)</th>
      <th>T</th>
      <th>RH</th>
      <th>AH</th>
    </tr>
    <tr>
      <th>Date_Time</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2004-03-10 18:00:00</th>
      <td>2.6</td>
      <td>1360.00</td>
      <td>150.0</td>
      <td>11.881723</td>
      <td>1045.50</td>
      <td>166.0</td>
      <td>1056.25</td>
      <td>113.0</td>
      <td>1692.00</td>
      <td>1267.50</td>
      <td>13.6</td>
      <td>48.875001</td>
      <td>0.757754</td>
    </tr>
    <tr>
      <th>2004-03-10 19:00:00</th>
      <td>2.0</td>
      <td>1292.25</td>
      <td>112.0</td>
      <td>9.397165</td>
      <td>954.75</td>
      <td>103.0</td>
      <td>1173.75</td>
      <td>92.0</td>
      <td>1558.75</td>
      <td>972.25</td>
      <td>13.3</td>
      <td>47.700000</td>
      <td>0.725487</td>
    </tr>
  </tbody>
</table></div>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">8</span><span class="p">),</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plot_cols</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'CO(GT)'</span><span class="p">,</span> <span class="s1">'NO2(GT)'</span><span class="p">,</span> <span class="s1">'C6H6(GT)'</span><span class="p">,</span> <span class="s1">'T'</span><span class="p">,</span> <span class="s1">'RH'</span><span class="p">]</span>
<span class="n">aq_df</span><span class="p">[</span><span class="n">plot_cols</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">subplots</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ax</span><span class="p">)):</span> 
    <span class="n">ax</span><span class="p">[</span><span class="n">a</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">plot_cols</span><span class="p">[</span><span class="n">a</span><span class="p">])</span>
<span class="n">ax</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">''</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="images/050e71c21431e46f47e251ad8049c5a8d6b7c3c51abd4fdbf6f509ef44913bb8.png" src="images/050e71c21431e46f47e251ad8049c5a8d6b7c3c51abd4fdbf6f509ef44913bb8.png" style="max-width: 100%; height: auto; display: block;">
</div>
</div>
</section>
<section id="b-suc-khoe-toan-cau-tu-ngan-hang-the-gioi-the-world-bank">
<h4>B. Sức khỏe Toàn cầu từ Ngân hàng Thế giới (The World Bank)</h4>
<p>Tập dữ liệu này kết hợp các số liệu thống kê y tế quan trọng từ nhiều nguồn khác nhau để cung cấp cái nhìn về xu hướng dân số và sức khỏe toàn cầu. Nó bao gồm thông tin về dinh dưỡng, sức khỏe sinh sản, giáo dục, tiêm chủng và bệnh tật từ hơn 200 quốc gia. Tập dữ liệu có thể được tải xuống tại <strong><a class="reference external" href="https://console.cloud.google.com/marketplace/product/the-world-bank/global-health?filter=solution-type:dataset&amp;filter=category:health&amp;id=f3c38e10-2c45-43c8-8a12-8d749ba987ee">đây</a></strong>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ind_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">'../data/WorldBankHealth/WorldBankHealthPopulation_SeriesSummary.csv'</span><span class="p">)</span>\
            <span class="o">.</span><span class="n">loc</span><span class="p">[:,[</span><span class="s1">'series_code'</span><span class="p">,</span> <span class="s1">'indicator_name'</span><span class="p">]]</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span><span class="o">.</span><span class="n">reindex</span><span class="p">()</span>\
            <span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">'indicator_name'</span><span class="p">)</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">'series_code'</span><span class="p">)</span>
<span class="n">hn_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">'../data/WorldBankHealth/WorldBankHealthPopulation_HealthNutritionPopulation.csv'</span><span class="p">)</span>\
            <span class="o">.</span><span class="n">pivot</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="s1">'year'</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="s1">'indicator_code'</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="s1">'value'</span><span class="p">)</span>

<span class="n">cols</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'SH.XPD.KHEX.GD.ZS'</span><span class="p">,</span> <span class="s1">'SH.XPD.CHEX.GD.ZS'</span><span class="p">,</span> <span class="s1">'SH.XPD.GHED.GD.ZS'</span><span class="p">]</span>
<span class="n">health_expenditure_df</span> <span class="o">=</span> <span class="n">hn_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span> <span class="mi">2018</span><span class="p">),</span> <span class="n">cols</span><span class="p">]</span>\
    <span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">ind_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">cols</span><span class="p">]</span><span class="o">.</span><span class="n">indicator_name</span>\
                           <span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s1">'_'</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">'('</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">' '</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]))))</span>
<span class="n">health_expenditure_df</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s1">'2000-1-1'</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">health_expenditure_df</span><span class="p">),</span> <span class="n">freq</span><span class="o">=</span><span class="s2">"A-DEC"</span><span class="p">)</span>
<span class="n">health_expenditure_df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<div class="table-container"><table class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>indicator_code</th>
      <th>Capital_health_expenditure</th>
      <th>Current_health_expenditure</th>
      <th>Domestic_general_government_health_expenditure</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2000-12-31</th>
      <td>0.013654</td>
      <td>3.154818</td>
      <td>1.400685</td>
    </tr>
    <tr>
      <th>2001-12-31</th>
      <td>0.012675</td>
      <td>2.947059</td>
      <td>1.196554</td>
    </tr>
    <tr>
      <th>2002-12-31</th>
      <td>0.018476</td>
      <td>2.733301</td>
      <td>1.012481</td>
    </tr>
  </tbody>
</table></div>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">7</span><span class="p">))</span>
<span class="n">health_expenditure_df</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">subplots</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">y_label</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'Capital health expenditure'</span><span class="p">,</span> <span class="s1">'Current health expenditure'</span><span class="p">,</span>
           <span class="s1">'Domestic general government</span><span class="se">\n</span><span class="s1"> health expenditure'</span><span class="p">]</span>
<span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ax</span><span class="p">)):</span> 
    <span class="n">ax</span><span class="p">[</span><span class="n">a</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">y_label</span><span class="p">[</span><span class="n">a</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s2"> (% of GDP)"</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="images/c1c6e02db818198eefb5b021e6a0365be038a1523083a8402fd54eb42e308697.png" src="images/c1c6e02db818198eefb5b021e6a0365be038a1523083a8402fd54eb42e308697.png" style="max-width: 100%; height: auto; display: block;">
</div>
</div>
</section>
<section id="c-lai-suat-kho-bac-hoa-ky-us-treasury-rates">
<h4>C. Lãi suất Kho bạc Hoa Kỳ (US Treasury Rates)</h4>
<p>Từ tháng 1 năm 1982 đến tháng 12 năm 2016 (Theo tuần)
https://essentialoftimeseries.com/data/
Tập dữ liệu mẫu này chứa dữ liệu theo tuần về lãi suất Kho bạc Hoa Kỳ từ tháng 1 năm 1982 đến tháng 12 năm 2016. Tập dữ liệu có thể được tải xuống tại <strong><a class="reference external" href="https://essentialoftimeseries.com/data/">đây</a></strong>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">treas_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="s2">"../data/USTreasuryRates/us-treasury-rates-weekly.xlsx"</span><span class="p">)</span>
<span class="n">treas_df</span> <span class="o">=</span> <span class="n">treas_df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">'Unnamed: 0'</span><span class="p">:</span> <span class="s1">'Date'</span><span class="p">})</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">'Date'</span><span class="p">)</span>
<span class="n">treas_df</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">treas_df</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
<span class="n">treas_df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<div class="table-container"><table class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>1-month</th>
      <th>3-month</th>
      <th>6-month</th>
      <th>1-year</th>
      <th>2-year</th>
      <th>3-year</th>
      <th>5-year</th>
      <th>7-year</th>
      <th>10-year</th>
      <th>Excess CRSP Mkt Returns</th>
      <th>10-year Treasury Returns</th>
      <th>Term spread</th>
      <th>Change in term spread</th>
      <th>5-year Treasury Returns</th>
      <th>Unnamed: 15</th>
      <th>Excess 10-year Treasury Returns</th>
      <th>Term Spread</th>
      <th>VXO</th>
      <th>Delta VXO</th>
    </tr>
    <tr>
      <th>Date</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1982-01-08</th>
      <td>10.296</td>
      <td>12.08</td>
      <td>13.36</td>
      <td>13.80</td>
      <td>14.12</td>
      <td>14.32</td>
      <td>14.46</td>
      <td>14.54</td>
      <td>14.47</td>
      <td>-1.632</td>
      <td>NaN</td>
      <td>2.39</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>-0.286662</td>
      <td>1.729559</td>
      <td>20.461911</td>
      <td>-0.003106</td>
    </tr>
    <tr>
      <th>1982-01-15</th>
      <td>10.296</td>
      <td>12.72</td>
      <td>13.89</td>
      <td>14.39</td>
      <td>14.67</td>
      <td>14.73</td>
      <td>14.79</td>
      <td>14.84</td>
      <td>14.76</td>
      <td>-2.212</td>
      <td>-2.9</td>
      <td>2.04</td>
      <td>-0.35</td>
      <td>1.65</td>
      <td>-2.556</td>
      <td>-3.758000</td>
      <td>4.464000</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1982-01-22</th>
      <td>10.296</td>
      <td>13.47</td>
      <td>14.30</td>
      <td>14.72</td>
      <td>14.93</td>
      <td>14.92</td>
      <td>14.81</td>
      <td>14.80</td>
      <td>14.73</td>
      <td>-0.202</td>
      <td>0.3</td>
      <td>1.26</td>
      <td>-0.78</td>
      <td>0.10</td>
      <td>0.049</td>
      <td>-0.558000</td>
      <td>4.434000</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table></div>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">data_df</span> <span class="o">=</span> <span class="n">treas_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">9</span><span class="p">]</span>
<span class="n">data_df</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">'US Treasury yield (%)'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">''</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">ncol</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="images/34a9b8fa7b516c6b559d801128f2b119d60e54414041523fe3791b573307c0d6.png" src="images/34a9b8fa7b516c6b559d801128f2b119d60e54414041523fe3791b573307c0d6.png" style="max-width: 100%; height: auto; display: block;">
</div>
</div>
</section>
<section id="d-du-lieu-khi-hau-jena">
<h4>D. Dữ liệu khí hậu Jena</h4>
<p>Tập dữ liệu chuỗi thời gian được ghi nhận tại Trạm khí tượng của Viện Hóa địa sinh học Max Planck ở Jena, Đức từ năm 2009 đến năm 2016. Nó chứa 14 đại lượng khác nhau (ví dụ: nhiệt độ không khí, áp suất khí quyển, độ ẩm, hướng gió, v.v.) được ghi lại sau mỗi 10 phút. Tập dữ liệu có thể được tải xuống tại <strong><a class="reference external" href="https://www.kaggle.com/stytch16/jena-climate-2009-2016">đây</a></strong>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">jena_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">'../data/jena_climate_2009_2016.csv'</span><span class="p">)</span>
<span class="n">jena_data</span><span class="p">[</span><span class="s1">'Date Time'</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">jena_data</span><span class="p">[</span><span class="s1">'Date Time'</span><span class="p">])</span>
<span class="n">jena_data</span> <span class="o">=</span> <span class="n">jena_data</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">'Date Time'</span><span class="p">)</span>
<span class="n">jena_data</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<div class="table-container"><table class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>p (mbar)</th>
      <th>T (degC)</th>
      <th>Tpot (K)</th>
      <th>Tdew (degC)</th>
      <th>rh (%)</th>
      <th>VPmax (mbar)</th>
      <th>VPact (mbar)</th>
      <th>VPdef (mbar)</th>
      <th>sh (g/kg)</th>
      <th>H2OC (mmol/mol)</th>
      <th>rho (g/m**3)</th>
      <th>wv (m/s)</th>
      <th>max. wv (m/s)</th>
      <th>wd (deg)</th>
    </tr>
    <tr>
      <th>Date Time</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2009-01-01 00:10:00</th>
      <td>996.52</td>
      <td>-8.02</td>
      <td>265.40</td>
      <td>-8.90</td>
      <td>93.3</td>
      <td>3.33</td>
      <td>3.11</td>
      <td>0.22</td>
      <td>1.94</td>
      <td>3.12</td>
      <td>1307.75</td>
      <td>1.03</td>
      <td>1.75</td>
      <td>152.3</td>
    </tr>
    <tr>
      <th>2009-01-01 00:20:00</th>
      <td>996.57</td>
      <td>-8.41</td>
      <td>265.01</td>
      <td>-9.28</td>
      <td>93.4</td>
      <td>3.23</td>
      <td>3.02</td>
      <td>0.21</td>
      <td>1.89</td>
      <td>3.03</td>
      <td>1309.80</td>
      <td>0.72</td>
      <td>1.50</td>
      <td>136.1</td>
    </tr>
    <tr>
      <th>2009-01-01 00:30:00</th>
      <td>996.53</td>
      <td>-8.51</td>
      <td>264.91</td>
      <td>-9.31</td>
      <td>93.9</td>
      <td>3.21</td>
      <td>3.01</td>
      <td>0.20</td>
      <td>1.88</td>
      <td>3.02</td>
      <td>1310.24</td>
      <td>0.19</td>
      <td>0.63</td>
      <td>171.6</td>
    </tr>
  </tbody>
</table></div>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">jena_data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">16</span><span class="p">),</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">jena_data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1000</span><span class="p">:]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">subplots</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">''</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="images/1ad97242c283c8f17dd127d98c514e88a8aa40d82d489ac314456f60ccc391cb.png" src="images/1ad97242c283c8f17dd127d98c514e88a8aa40d82d489ac314456f60ccc391cb.png" style="max-width: 100%; height: auto; display: block;">
</div>
</div>
</section>
</section>
<section id="kien-thuc-nen-tang" class="tex2jax_process display">
<h3 id="kien-thuc-nen-tang-4">Kiến thức nền tảng</h3>
<p>Trước khi thảo luận về mô hình VAR, chúng tôi tóm lược một số khái niệm cơ bản dưới đây cần thiết để hiểu về mô hình này.</p>
<section id="tinh-dung-yeu-cua-chuoi-thoi-gian-da-bien" class="tex2jax_process">
<h4>Tính dừng yếu của chuỗi thời gian đa biến</h4>
<p>Tương tự như trường hợp đơn biến, một trong những yêu cầu cần đáp ứng trước khi áp dụng mô hình VAR là tính dừng – cụ thể là tính dừng yếu (weak stationarity). Trong cả trường hợp đơn biến và đa biến, hai mô-men đầu tiên của chuỗi thời gian phải không thay đổi theo thời gian. Một cách chính thức hơn, chúng tôi mô tả tính dừng yếu như sau:</p>
<p class="tex2jax_process">Xét một chuỗi thời gian <span class="math notranslate nohighlight tex2jax_process">\(N\)</span> chiều, <span class="math notranslate nohighlight tex2jax_process">\(\mathbf{y}_t = \left[y_{1,t}, y_{2,t}, ..., y_{N,t}\right]^\prime\)</span>. Chuỗi này được gọi là dừng yếu nếu hai mô-men đầu tiên là hữu hạn và không đổi theo thời gian, tức là:</p>
<ol class="arabic simple tex2jax_process">
<li class="tex2jax_process"><p class="tex2jax_process"><span class="math notranslate nohighlight tex2jax_process">\(E\left[\mathbf{y}_t\right] = \boldsymbol{\mu}\)</span></p></li>
<li class="tex2jax_process"><p class="tex2jax_process"><span class="math notranslate nohighlight tex2jax_process">\(E\left[(\mathbf{y}_t-\boldsymbol{\mu})(\mathbf{y}_t-\boldsymbol{\mu})^\prime\right] \equiv \boldsymbol\Gamma_0 &lt; \infty\)</span> với mọi <span class="math notranslate nohighlight tex2jax_process">\(t\)</span></p></li>
<li class="tex2jax_process"><p class="tex2jax_process"><span class="math notranslate nohighlight tex2jax_process">\(E\left[(\mathbf{y}_t-\boldsymbol{\mu})(\mathbf{y}_{t-h}-\boldsymbol{\mu})^\prime\right] \equiv \boldsymbol\Gamma_h\)</span> với mọi <span class="math notranslate nohighlight tex2jax_process">\(t\)</span> và <span class="math notranslate nohighlight tex2jax_process">\(h\)</span></p></li>
</ol>
<p class="tex2jax_process">Trong đó các giá trị kỳ vọng được lấy theo từng phần tử trên phân phối đồng thời của <span class="math notranslate nohighlight tex2jax_process">\(\mathbf{y}_t\)</span>:</p>
<ul class="simple tex2jax_process">
<li class="tex2jax_process"><p class="tex2jax_process"><span class="math notranslate nohighlight tex2jax_process">\(\boldsymbol{\mu}\)</span> là vectơ trung bình <span class="math notranslate nohighlight tex2jax_process">\(\boldsymbol\mu = \left[\mu_1, \mu_2, ..., \mu_N \right]\)</span></p></li>
<li class="tex2jax_process"><p class="tex2jax_process"><span class="math notranslate nohighlight tex2jax_process">\(\boldsymbol\Gamma_0\)</span> là ma trận hiệp phương sai kích thước <span class="math notranslate nohighlight tex2jax_process">\(N\times N\)</span> , trong đó phần tử trên đường chéo thứ <span class="math notranslate nohighlight tex2jax_process">\(i\)</span>th là phương sai của <span class="math notranslate nohighlight tex2jax_process">\(y_{i,t}\)</span>,và phần tử thứ <span class="math notranslate nohighlight tex2jax_process">\((i, j)\)</span>th là hiệp phương sai giữa <span class="math notranslate nohighlight tex2jax_process">\(y_{i,t}\)</span> and <span class="math notranslate nohighlight tex2jax_process">\({y_{j,t}}\)</span></p></li>
<li class="tex2jax_process"><p class="tex2jax_process"><span class="math notranslate nohighlight tex2jax_process">\(\boldsymbol\Gamma_h\)</span> là ma trận hiệp phương sai chéo (cross-covariance matrix) tại độ trễ <span class="math notranslate nohighlight tex2jax_process">\(h\)</span></p></li>
</ul>
</section>
<section id="lay-ma-tran-tuong-quan-cheo-tu-ma-tran-hiep-phuong-sai-cheo" class="tex2jax_process display">
<h4>Lấy ma trận tương quan chéo từ ma trận hiệp phương sai chéo</h4>
<p>Khi xử lý chuỗi thời gian đa biến, chúng ta có thể xem xét khả năng dự báo của một biến đối với một biến khác bằng cách xem xét mối quan hệ giữa chúng thông qua hàm hiệp phương sai chéo (CCVF) và hàm tương quan chéo (CCF). Để thực hiện việc này, chúng ta bắt đầu bằng cách định nghĩa hiệp phương sai chéo giữa hai biến, sau đó ước tính mức độ tương quan chéo giữa một biến và một biến khác bị dịch chuyển theo thời gian. Điều này cho chúng ta biết liệu một chuỗi thời gian có thể liên quan đến các độ trễ trong quá khứ của chuỗi kia hay không. Nói cách khác, CCF được sử dụng để xác định các độ trễ của một biến mà có thể hữu ích để làm biến dự báo cho biến còn lại.</p>
<p><strong>Tại độ trễ 0</strong>:</p>
<p class="tex2jax_process">Giả sử <span class="math notranslate nohighlight tex2jax_process">\(\mathbf\Gamma_0\)</span> là ma trận hiệp phương sai tại độ trễ 0, <span class="math notranslate nohighlight tex2jax_process">\(\mathbf D\)</span> là một ma trận đường chéo kích thước <span class="math notranslate nohighlight tex2jax_process">\(N\times N\)</span> chứa các độ lệch chuẩn của <span class="math notranslate nohighlight tex2jax_process">\(y_{i,t}\)</span> với <span class="math notranslate nohighlight tex2jax_process">\(i=1, ..., N\)</span>. Ma trận tương quan của <span class="math notranslate nohighlight tex2jax_process">\(\mathbf{y}_t\)</span> được định nghĩa là:</p>
<div class="math notranslate nohighlight tex2jax_process display">
\[\boldsymbol\rho_0 = \mathbf D^{-1}\mathbf\Gamma_0\mathbf D^{-1}\]</div>
<p class="tex2jax_process">Trong đó phần tử thứ <span class="math notranslate nohighlight tex2jax_process">\((i, j)\)</span> của <span class="math notranslate nohighlight tex2jax_process">\(\boldsymbol\rho_0\)</span> là hệ số tương quan giữa <span class="math notranslate nohighlight tex2jax_process">\(y_{i,t}\)</span> và <span class="math notranslate nohighlight tex2jax_process">\(y_{j,t}\)</span> tại thời điểm <span class="math notranslate nohighlight tex2jax_process">\(t\)</span>:</p>
<div class="math notranslate nohighlight tex2jax_process display">
\[\rho_{i,j}(0) = \dfrac{Cov\left[y_{i,t}, y_{j,t} \right]}{\sigma_{i,t} \sigma_{j,t}}\]</div>
<p><strong>Tại độ trễ h</strong>:</p>
<p class="tex2jax_process">Giả sử <span class="math notranslate nohighlight tex2jax_process">\(\boldsymbol\Gamma_h = E\left[(\mathbf{y}_t-\boldsymbol{\mu})(\mathbf{y}_{t-h}-\boldsymbol{\mu})^\prime\right]\)</span> là ma trận hiệp phương sai chéo tại độ trễ <span class="math notranslate nohighlight tex2jax_process">\(h\)</span> của <span class="math notranslate nohighlight tex2jax_process">\(\mathbf y_{t}\)</span>. Ma trận tương quan chéo tại độ trễ <span class="math notranslate nohighlight tex2jax_process">\(h\)</span> được định nghĩa là:</p>
<div class="math notranslate nohighlight tex2jax_process display">
\[\boldsymbol\rho_h = \mathbf D^{-1}\mathbf\Gamma_h\mathbf D^{-1}\]</div>
<p class="tex2jax_process">Phần tử thứ <span class="math notranslate nohighlight tex2jax_process">\((i,j)\)</span> của <span class="math notranslate nohighlight tex2jax_process">\(\boldsymbol\rho_h\)</span> là hệ số tương quan giữa <span class="math notranslate nohighlight tex2jax_process">\(y_{i,t}\)</span> và <span class="math notranslate nohighlight tex2jax_process">\(y_{j,t-h}\)</span>:</p>
<div class="math notranslate nohighlight tex2jax_process display">
\[\rho_{i,j}(h) = \dfrac{Cov\left[y_{i,t}, y_{j,t-h} \right]}{\sigma_{i,t} \sigma_{j,t}}\]</div>
<p><strong>Chúng ta rút ra được điều gì từ kết quả này?</strong></p>
<div class="pst-scrollable-table-container tex2jax_process"><div class="table-container tex2jax_process"><table class="table tex2jax_process">
<thead>
<tr class="row-odd"><th class="head text-left"><p>Hệ số tương quan</p></th>
<th class="head text-left"><p>Giải thích ý nghĩa</p></th>
</tr>
</thead>
<tbody class="tex2jax_process">
<tr class="row-even tex2jax_process"><td class="text-left tex2jax_process"><p class="tex2jax_process"><span class="math notranslate nohighlight tex2jax_process">\(\rho_{i,j}(0)\neq0\)</span></p></td>
<td class="text-left tex2jax_process"><p class="tex2jax_process"><span class="math notranslate nohighlight tex2jax_process">\(y_{i,t}\)</span> và <span class="math notranslate nohighlight tex2jax_process">\(y_{j,t}\)</span> có <em>tương quan tuyến tính đồng thời</em> (xảy ra cùng lúc)</p></td>
</tr>
<tr class="row-odd tex2jax_process"><td class="text-left tex2jax_process"><p class="tex2jax_process"><span class="math notranslate nohighlight tex2jax_process">\(\rho_{i,j}(h)=\rho_{j,i}(h)=0\)</span> với mọi <span class="math notranslate nohighlight tex2jax_process">\(h\geq0\)</span></p></td>
<td class="text-left tex2jax_process"><p class="tex2jax_process"><span class="math notranslate nohighlight tex2jax_process">\(y_{i,t}\)</span> và <span class="math notranslate nohighlight tex2jax_process">\(y_{j,t}\)</span> <em>không có mối quan hệ tuyến tính</em> nào với nhau.</p></td>
</tr>
<tr class="row-even tex2jax_process"><td class="text-left tex2jax_process"><p class="tex2jax_process"><span class="math notranslate nohighlight tex2jax_process">\(\rho_{i,j}(h)=0\)</span> và <span class="math notranslate nohighlight tex2jax_process">\(\rho_{j,i}(h)=0\)</span> với mọi <span class="math notranslate nohighlight tex2jax_process">\(h&gt;0\)</span></p></td>
<td class="text-left tex2jax_process"><p class="tex2jax_process"><span class="math notranslate nohighlight tex2jax_process">\(y_{i,t}\)</span> và <span class="math notranslate nohighlight tex2jax_process">\(y_{j,t}\)</span> được gọi là <em>không có liên kết tuyến tính (linearly uncoupled)</em>.</p></td>
</tr>
<tr class="row-odd tex2jax_process"><td class="text-left tex2jax_process"><p class="tex2jax_process"><span class="math notranslate nohighlight tex2jax_process">\(\rho_{i,j}(h)=0\)</span> với mọi <span class="math notranslate nohighlight tex2jax_process">\(h&gt;0\)</span>, nhưng <span class="math notranslate nohighlight tex2jax_process">\(\rho_{j,i}(q)\neq0\)</span> với ít nhất một <span class="math notranslate nohighlight tex2jax_process">\(q&gt;0\)</span></p></td>
<td class="text-left tex2jax_process"><p class="tex2jax_process">Có <em>mối quan hệ tuyến tính một chiều giữa</em> giữa <span class="math notranslate nohighlight tex2jax_process">\(y_{i,t}\)</span> và <span class="math notranslate nohighlight tex2jax_process">\(y_{j,t}\)</span>, trong đó <span class="math notranslate nohighlight tex2jax_process">\(y_{i,t}\)</span> không phụ thuộc vào <span class="math notranslate nohighlight tex2jax_process">\(y_{j,t}\)</span>, nhưng <span class="math notranslate nohighlight tex2jax_process">\(y_{j,t}\)</span> phụ thuộc vào (một số) giá trị trễ của <span class="math notranslate nohighlight tex2jax_process">\(y_{i,t}\)</span></p></td>
</tr>
<tr class="row-even tex2jax_process"><td class="text-left tex2jax_process"><p class="tex2jax_process"><span class="math notranslate nohighlight tex2jax_process">\(\rho_{i,j}(h)\neq0\)</span> với ít nhất một <span class="math notranslate nohighlight tex2jax_process">\(h&gt;0\)</span> và <span class="math notranslate nohighlight tex2jax_process">\(\rho_{j,i}(q)\neq0\)</span> với ít nhất một <span class="math notranslate nohighlight tex2jax_process">\(q&gt;0\)</span></p></td>
<td class="text-left tex2jax_process"><p class="tex2jax_process">Có một <em>mối quan hệ tuyến tính hai chiều (phản hồi)</em> giữa <span class="math notranslate nohighlight tex2jax_process">\(y_{i,t}\)</span> và <span class="math notranslate nohighlight tex2jax_process">\(y_{j,t}\)</span></p></td>
</tr>
</tbody>
</table></div>
</div>
</section>
</section>
</section>
<section id="cac-mo-hinh-vecto-tu-hoi-quy-var" class="tex2jax_process display">
<h2 id="cac-mo-hinh-vecto-tu-hoi-quy-var--5">Các mô hình Vectơ tự hồi quy (VAR)</h2>
<p>Mô hình vectơ tự hồi quy (VAR) là một trong những mô hình thành công nhất để phân tích chuỗi thời gian đa biến. Mô hình này đã chứng minh được hiệu quả trong việc mô tả các mối quan hệ và dự báo các chuỗi thời gian kinh tế và tài chính, đồng thời cung cấp các dự báo chính xác hơn so với các mô hình chuỗi thời gian đơn biến và các mô hình hệ phương trình đồng thời dựa trên lý thuyết.</p>
<p class="tex2jax_process">Cấu trúc của mô hình VAR thực chất là sự <strong>tổng quát hóa của mô hình AR đơn biến (generalization of the univariate AR)</strong>. Đây là một mô hình hồi quy hệ thống (system regression model), coi tất cả các biến đều là biến nội sinh (endogenous), và cho phép mỗi biến phụ thuộc vào <span class="math notranslate nohighlight tex2jax_process">\(p\)</span> giá trị trễ của chính nó cũng như của tất cả các biến khác trong hệ thống.</p>
<p class="tex2jax_process">Một mô hình VAR bậc <span class="math notranslate nohighlight tex2jax_process">\(p\)</span> có thể được biểu diễn như sau:</p>
<div class="math notranslate nohighlight tex2jax_process display">
\[\mathbf y_t=\mathbf a_0 + \mathbf A_1 \mathbf y_{t-1} + \mathbf A_2 \mathbf y_{t-2} + ... + \mathbf A_p \mathbf y_{t-p} + \mathbf u_t = \mathbf a_0  + \sum_{j=1}^{p} \mathbf A_j \mathbf y_{t-j} + \mathbf u_t\]</div>
<p class="tex2jax_process">Trong đó:<span class="math notranslate nohighlight tex2jax_process">\(\mathbf y_t\)</span> là một vectơ cột kích thước <span class="math notranslate nohighlight tex2jax_process">\(N \times 1\)</span> chứa <span class="math notranslate nohighlight tex2jax_process">\(N\)</span> biến nội sinh.<span class="math notranslate nohighlight tex2jax_process">\(\mathbf a_0\)</span> là một vectơ cột kích thước <span class="math notranslate nohighlight tex2jax_process">\(N \times 1\)</span> chứa các hằng số. <span class="math notranslate nohighlight tex2jax_process">\(\mathbf A_1, \mathbf A_2, ..., \mathbf A_p\)</span> là <span class="math notranslate nohighlight tex2jax_process">\(p\)</span> ma trận hệ số tự hồi quy, mỗi ma trận có kích thước <span class="math notranslate nohighlight tex2jax_process">\(N \times N\)</span> và <span class="math notranslate nohighlight tex2jax_process">\(\mathbf u_t\)</span> Là một vectơ cột kích thước <span class="math notranslate nohighlight tex2jax_process">\(N \times 1\)</span> chứa các nhiễu trắng (white noise).</p>
<section id="mo-hinh-var-1" class="tex2jax_process display">
<h3 id="mo-hinh-var-1--6">Mô hình VAR(1)</h3>
<p class="tex2jax_process">Để minh họa, chúng ta hãy xem xét mô hình VAR đơn giản nhất với bậc trễ <span class="math notranslate nohighlight tex2jax_process">\(p=1\)</span>.</p>
<section id="dang-cau-truc-va-dang-rut-gon-cua-mo-hinh-var" class="tex2jax_process display">
<h4>Dạng cấu trúc và dạng rút gọn của mô hình VAR</h4>
<p>Xét hệ hai biến số sau đây:</p>
<div class="math notranslate nohighlight tex2jax_process display">
\[ y_{1,t} = b_{1,0} - b_{1,2}y_{2,t} +  \varphi_{1,1}y_{1,t-1} + \varphi_{1,2}y_{2,t-1} + \varepsilon_{1,t}\]</div>
<div class="math notranslate nohighlight tex2jax_process display">
\[ y_{2,t} = b_{2,0} - b_{2,1}y_{2,t} +  \varphi_{2,1}y_{1,t-1} + \varphi_{2,2}y_{2,t-1} + \varepsilon_{2,t}\]</div>
<p class="tex2jax_process">Trong đó, cả <span class="math notranslate nohighlight tex2jax_process">\(y_{1,t}\)</span> và <span class="math notranslate nohighlight tex2jax_process">\(y_{2,t}\)</span> được giả định là các chuỗi dừng, còn <span class="math notranslate nohighlight tex2jax_process">\(\varepsilon_{1,t}\)</span> và <span class="math notranslate nohighlight tex2jax_process">\(\varepsilon_{2,t}\)</span> <span class="math notranslate nohighlight tex2jax_process">\(\varepsilon_{2,t}\)</span> là các thành phần sai số không tương quan với độ lệch chuẩn lần lượt là <span class="math notranslate nohighlight tex2jax_process">\(\sigma_{1,t}\)</span> và <span class="math notranslate nohighlight tex2jax_process">\(\sigma_{2,t}\)</span>.</p>
<p>Biểu diễn dưới dạng ma trận:</p>
<img alt="images/bivariate1.png" src="images/bivariate1.png" style="max-width: 100%; height: auto; display: block;">
<p>Đặt các ma trận như sau:</p>
<img alt="images/bivariate2.png" src="images/bivariate2.png" style="max-width: 100%; height: auto; display: block;">
<p>Khi đó</p>
<div class="math notranslate nohighlight tex2jax_process display">
\[\mathbf B \mathbf y_t = \mathbf Q_0 + \mathbf Q_1 \mathbf y_{t-1} + \boldsymbol\varepsilon_t\]</div>
<section id="mo-hinh-var-dang-cau-truc-var-o-dang-nguyen-thuy" class="tex2jax_process display">
<h5>Mô hình VAR dạng cấu trúc (VAR ở dạng nguyên thủy)</h5>
<ul class="simple tex2jax_process">
<li><p>Được mô tả bởi hệ phương trình đã nêu ở trên.</p></li>
<li class="tex2jax_process"><p class="tex2jax_process">Ghi lại các tác động phản hồi đồng thời (các hệ số <span class="math notranslate nohighlight tex2jax_process">\(b_{1,2}, b_{2,1}\)</span>)</p></li>
<li><p>Không có tính ứng dụng thực tế cao trong việc tính toán trực tiếp.</p></li>
<li class="tex2jax_process"><p class="tex2jax_process">Các thành phần đồng thời (contemporaneous terms) không thể được sử dụng trực tiếp để dự báo tương lai (vì tại thời điểm <span class="math notranslate nohighlight tex2jax_process">\(t\)</span>, anh chưa biết giá trị của cả hai biến để dự báo lẫn nhau).</p></li>
<li class="tex2jax_process"><p class="tex2jax_process">Cần thực hiện thêm các bước biến đổi để trở nên hữu ích hơn (ví dụ: nhân phương trình ma trận với <span class="math notranslate nohighlight tex2jax_process">\(\mathbf{B}^{-1}\)</span>).</p></li>
</ul>
<p class="tex2jax_process">Nhân phương trình ma trận với <span class="math notranslate nohighlight tex2jax_process">\(\mathbf B^{-1}\)</span>, chúng ta thu được:</p>
<div class="math notranslate nohighlight tex2jax_process display">
\[\mathbf y_t = \mathbf a_0 + \mathbf A_1 \mathbf y_{t-1} + \mathbf u_t\]</div>
<p>hoặc</p>
<div class="math notranslate nohighlight tex2jax_process display">
\[\mathbf y_t = \mathbf a_0 + \mathbf A_1 L\mathbf y_t + \mathbf u_t\]</div>
<p class="tex2jax_process">Trong đó <span class="math notranslate nohighlight tex2jax_process">\(\mathbf a_0 = \mathbf B^{-1}\mathbf Q_0\)</span>, <span class="math notranslate nohighlight tex2jax_process">\(\mathbf A_1 = \mathbf B^{-1}\mathbf Q_1\)</span>, <span class="math notranslate nohighlight tex2jax_process">\(L\)</span> là toán tử trễ (lag/backshift operator), và <span class="math notranslate nohighlight tex2jax_process">\(\mathbf u_t = \mathbf B^{-1}\boldsymbol\varepsilon_t\)</span>. Một cách tương đương, ta có hệ phương trình:</p>
<div class="math notranslate nohighlight tex2jax_process display">
\[ y_{1,t} = a_{1,0} + a_{1,1}y_{1,t-1} + a_{1,2}y_{2,t-1} + u_{1,t}\]</div>
<div class="math notranslate nohighlight tex2jax_process display">
\[ y_{2,t} = a_{2,0} + a_{2,1}y_{1,t-1} + a_{2,2}y_{2,t-1} + u_{2,t}\]</div>
</section>
<section id="reduced-form-var-var-in-standard-form">
<h5>Reduced-form VAR (VAR in standard form)</h5>
<ul class="simple">
<li><p>Được mô tả bởi hệ phương trình đã biến đổi ở trên.</p></li>
<li><p>Chỉ phụ thuộc vào các biến nội sinh ở các thời điểm trễ trong quá khứ (không còn các tác động phản hồi đồng thời).</p></li>
<li><p>Có thể được ước lượng bằng phương pháp bình phương tối thiểu thông thường (OLS).</p></li>
</ul>
</section>
</section>
<section id="bieu-dien-vma-vo-han-va-tinh-dung" class="tex2jax_process display">
<h4>Biểu diễn VMA vô hạn và Tính dừng</h4>
<p>Xét mô hình VAR(1) dạng rút gọn chuẩn:</p>
<div class="math notranslate nohighlight tex2jax_process display">
\[\mathbf y_t = \mathbf a_0 + \mathbf A_1 \mathbf y_{t-1} + \mathbf u_t\]</div>
<p class="tex2jax_process">Giả sử rằng quá trình này dừng yếu và lấy kỳ vọng của <span class="math notranslate nohighlight tex2jax_process">\(\mathbf y_t\)</span>, ta có:</p>
<div class="math notranslate nohighlight tex2jax_process display">
\[E\left[\mathbf y_t\right] = \mathbf a_0 + \mathbf A_1 E\left[\mathbf y_{t-1}\right]\]</div>
<p class="tex2jax_process">Trong đó <span class="math notranslate nohighlight tex2jax_process">\(E\left[\mathbf u_t\right]=0.\)</span> Nếu ta đặt <span class="math notranslate nohighlight tex2jax_process">\(\tilde{\mathbf y}_{t}\equiv \mathbf y_t - \boldsymbol \mu\)</span> là chuỗi thời gian đã được hiệu chỉnh giá trị trung bình (mean-corrected), ta có thể viết lại mô hình thành:</p>
<div class="math notranslate nohighlight tex2jax_process display">
\[\tilde{\mathbf y}_{t} = \mathbf A_1 \tilde{\mathbf y}_{t-1} + \mathbf u_t\]</div>
<p class="tex2jax_process">Thay thế <span class="math notranslate nohighlight tex2jax_process">\(\tilde{\mathbf y}_{t-1} = \mathbf A_1 \tilde{\mathbf y}_{t-2} + \mathbf u_{t-1}\)</span> vào phương trình trên, ta có:</p>
<div class="math notranslate nohighlight tex2jax_process display">
\[\tilde{\mathbf y}_{t} = \mathbf A_1 \left( \mathbf A_1 \tilde{\mathbf y}_{t-2} + \mathbf u_{t-1}\right)+ \mathbf u_t\]</div>
<p>Nếu chúng ta tiếp tục lặp lại quá trình thay thế này, ta thu được:</p>
<div class="math notranslate nohighlight tex2jax_process display">
\[\mathbf y_{t} = \boldsymbol\mu + \sum_{i=1}^{\infty} \mathbf A_1^i  \mathbf u_{t-i} + \mathbf u_t\]</div>
<p class="tex2jax_process">Đặt <span class="math notranslate nohighlight tex2jax_process">\(\boldsymbol\Theta_i\equiv A_1^i\)</span>, ta có được <strong>Biểu diễn Vectơ trung bình động vô hạn (VMA infinite representation)</strong>:</p>
<div class="math notranslate nohighlight tex2jax_process display">
\[\mathbf y_{t} = \boldsymbol\mu + \sum_{i=1}^{\infty} \boldsymbol\Theta_i  \mathbf u_{t-i} + \mathbf u_t\]</div>
</section>
<section id="tinh-dung-cua-mo-hinh-var-1" class="tex2jax_process">
<h4>Tính dừng của mô hình VAR(1)</h4>
<ul class="simple tex2jax_process">
<li class="tex2jax_process"><p class="tex2jax_process">Tất cả <span class="math notranslate nohighlight tex2jax_process">\(N\)</span> giá trị riêng của ma trận <span class="math notranslate nohighlight tex2jax_process">\(\mathbf{A}_1\)</span> phải có mô-đun nhỏ hơn 1, nhằm tránh việc ma trận hệ số <span class="math notranslate nohighlight tex2jax_process">\(\mathbf{A}_1^j\)</span> bị bùng nổ hoặc hội tụ về một ma trận khác không khi <span class="math notranslate nohighlight tex2jax_process">\(j\)</span> tiến tới vô hạn.</p></li>
<li class="tex2jax_process"><p class="tex2jax_process">Với điều kiện ma trận hiệp phương sai của <span class="math notranslate nohighlight tex2jax_process">\(\mathbf{u}_t\)</span> tồn tại, yêu cầu tất cả các giá trị riêng của <span class="math notranslate nohighlight tex2jax_process">\(\mathbf{A}_1\)</span> có mô-đun nhỏ hơn 1 là điều kiện cần và đủ để <span class="math notranslate nohighlight tex2jax_process">\(\mathbf{y}_t\)</span> ổn định, và do đó, đạt tính dừng.</p></li>
<li class="tex2jax_process"><p class="tex2jax_process">Tất cả các nghiệm của <span class="math notranslate nohighlight tex2jax_process">\(det\left(\mathbf I_N - \mathbf A_1 z\right)=0\)</span> phải nằm ngoài vòng tròn đơn vị.</p></li>
</ul>
</section>
</section>
<section id="mo-hinh-var-p" class="tex2jax_process display">
<h3 id="mo-hinh-var-p--7">Mô hình VAR(p)</h3>
<p>Xét mô hình VAR(p) được mô tả bởi:</p>
<div class="math notranslate nohighlight tex2jax_process display">
\[\mathbf y_t=\mathbf a_0 + \mathbf A_1 \mathbf y_{t-1} + \mathbf A_2 \mathbf y_{t-2} + ... + \mathbf A_p \mathbf y_{t-p} + \mathbf u_t = \mathbf a_0  + \sum_{j=1}^{p} \mathbf A_j \mathbf y_{t-j} + \mathbf u_t\]</div>
<p class="tex2jax_process">Sử dụng toán tử trễ <span class="math notranslate nohighlight tex2jax_process">\(L\)</span>, ta có:</p>
<div class="math notranslate nohighlight tex2jax_process display">
\[\tilde{\mathbf A} (L) \mathbf y_t = \mathbf a_0 + \mathbf u_t\]</div>
<p class="tex2jax_process">Trong đó <span class="math notranslate nohighlight tex2jax_process">\(\tilde{\mathbf A} (L) = (\mathbf I_N - A_1 L - ... - A_p L^p)\)</span>. Giả sử rằng <span class="math notranslate nohighlight tex2jax_process">\(\mathbf y_t\)</span> dừng yếu, ta thu được:</p>
<div class="math notranslate nohighlight tex2jax_process display">
\[\boldsymbol\mu = E\left[\mathbf y_t\right] = (\mathbf I_N - A_1 L - ... - A_p L^p)^{-1} \mathbf a_0\]</div>
<p class="tex2jax_process">Đặt <span class="math notranslate nohighlight tex2jax_process">\(\tilde{\mathbf y}_t=\mathbf y_t -\boldsymbol\mu\)</span>, ta có:</p>
<div class="math notranslate nohighlight tex2jax_process display">
\[\tilde{\mathbf y}_t =  \mathbf A_1 \tilde{\mathbf y}_{t-1} + \mathbf A_2 \tilde{\mathbf y}_{t-2} + ... + \mathbf A_p \tilde{\mathbf y}_{t-p} + \mathbf u_t\]</div>
<section id="dac-tinh" class="tex2jax_process">
<h4>Đặc tính</h4>
<ul class="simple tex2jax_process">
<li class="tex2jax_process"><p class="tex2jax_process"><span class="math notranslate nohighlight tex2jax_process">\(Cov[\mathbf y_t, \mathbf u_t] = \Sigma_u\)</span>, ma trận hiệp phương sai của <span class="math notranslate nohighlight tex2jax_process">\(\mathbf u_t\)</span></p></li>
<li class="tex2jax_process"><p class="tex2jax_process"><span class="math notranslate nohighlight tex2jax_process">\(Cov[\mathbf y_{t-h}, \mathbf u_t] = \mathbf 0\)</span> với mọi <span class="math notranslate nohighlight tex2jax_process">\(h&gt;0\)</span></p></li>
<li class="tex2jax_process"><p class="tex2jax_process"><span class="math notranslate nohighlight tex2jax_process">\(\boldsymbol\Gamma_h = \mathbf A_1 \boldsymbol\Gamma_{h-1} +...+\mathbf A_p \boldsymbol\Gamma_{h-p}\)</span> for <span class="math notranslate nohighlight tex2jax_process">\(h&gt;0\)</span></p></li>
<li class="tex2jax_process"><p class="tex2jax_process"><span class="math notranslate nohighlight tex2jax_process">\(\boldsymbol\rho_h = \boldsymbol \Psi_1 \boldsymbol\Gamma_{h-1} +...+\boldsymbol \Psi_p \boldsymbol\Gamma_{h-p}\)</span> for <span class="math notranslate nohighlight tex2jax_process">\(h&gt;0\)</span>, trong đó <span class="math notranslate nohighlight tex2jax_process">\(\boldsymbol \Psi_i = \mathbf D^{-1/2}\mathbf A_i D^{-1/2}\)</span></p></li>
</ul>
</section>
<section id="tinh-dung-cua-mo-hinh-var-p" class="tex2jax_process">
<h4>Tính dừng của mô hình VAR(p)</h4>
<ul class="simple tex2jax_process">
<li class="tex2jax_process"><p class="tex2jax_process">Tất cả các nghiệm của phương trình <span class="math notranslate nohighlight tex2jax_process">\(det\left(\mathbf I_N - \mathbf A_1 z - ...-  \mathbf A_p z^p\right)=0\)</span> phải nằm ngoài vòng tròn đơn vị.</p></li>
</ul>
</section>
</section>
<section id="xac-dinh-mo-hinh-var-lua-chon-bac-p" class="tex2jax_process display">
<h3 id="xac-dinh-mo-hinh-var-lua-chon-bac-p-8">Xác định mô hình VAR: Lựa chọn bậc <em>p</em></h3>
<p class="tex2jax_process">Việc khớp một mô hình VAR bao gồm việc lựa chọn một tham số duy nhất: bậc của mô hình hoặc độ dài độ trễ <span class="math notranslate nohighlight tex2jax_process">\(p\)</span>. Cách tiếp cận phổ biến nhất trong việc chọn mô hình tốt nhất là chọn giá trị <span class="math notranslate nohighlight tex2jax_process">\(p\)</span> sao cho tối thiểu hóa được một hoặc nhiều tiêu chí thông tin (information criteria) được đánh giá trên một phạm vi các bậc mô hình. Các tiêu chí này bao gồm hai thành phần: thành phần thứ nhất đặc trưng cho tỷ lệ entropy hoặc sai số dự báo, và thành phần thứ hai đặc trưng cho số lượng các tham số được ước lượng tự do trong mô hình. Việc tối thiểu hóa cả hai thành phần này sẽ cho phép chúng ta xác định được một mô hình mô phỏng chính xác dữ liệu đồng thời ngăn chặn hiện tượng quá khớp (overfitting - do có quá nhiều tham số).</p>
<p>Một số tiêu chí thông tin thường được sử dụng bao gồm: Tiêu chí thông tin Akaike (AIC), Tiêu chí thông tin Bayes của Schwarz (BIC), Tiêu chí Hannan-Quinn (HQ), và Tiêu chí Sai số dự báo cuối cùng của Akaike (FPE). Công thức cho mỗi tiêu chí được trình bày dưới đây.</p>
<p><em>Tiêu chí thông tin Akaike</em></p>
<div class="math notranslate nohighlight tex2jax_process display">
\[(M)\operatorname{AIC} = \operatorname{ln}|\tilde{\boldsymbol\Sigma}_u | + 2\dfrac{k}{T}\]</div>
<p><em>Tiêu chí thông tin Bayes của Schwarz</em></p>
<div class="math notranslate nohighlight tex2jax_process display">
\[(M)\operatorname{BIC} = \operatorname{ln}|\tilde{\boldsymbol\Sigma}_u | + \dfrac{k}{T}\operatorname{ln}(T)\]</div>
<p><em>Tiêu chí thông tin Hannan-Quinn</em></p>
<div class="math notranslate nohighlight tex2jax_process display">
\[(M)\operatorname{HQIC} = \operatorname{ln}|\tilde{\boldsymbol\Sigma}_u | + \dfrac{k}{T}\operatorname{ln}(\operatorname{ln}(T))\]</div>
<p><em>Sai số dự báo cuối cùng</em></p>
<div class="math notranslate nohighlight tex2jax_process display">
\[\operatorname{FPE}(p) = \left(\dfrac{T+Np+1}{T-Np+1} \right)^N |\tilde{\boldsymbol\Sigma}_u | \]</div>
<div class="math notranslate nohighlight tex2jax_process display">
\[\operatorname{ln}(\operatorname{FPE}(p)) = \operatorname{ln}|\tilde{\boldsymbol\Sigma}_u | + N \operatorname{ln}\left(\dfrac{T+Np+1}{T-Np+1} \right) \]</div>
<p class="tex2jax_process">Trong đó <span class="math notranslate nohighlight tex2jax_process">\(M\)</span> đại diện cho đa biến (multivariate), <span class="math notranslate nohighlight tex2jax_process">\(\tilde{\boldsymbol\Sigma}_u\)</span> là ma trận hiệp phương sai ước lượng của các phần dư, <span class="math notranslate nohighlight tex2jax_process">\(T\)</span>  là số lượng quan sát trong mẫu, và <span class="math notranslate nohighlight tex2jax_process">\(k\)</span> là tổng số lượng tham số trong mô hình VAR(<span class="math notranslate nohighlight tex2jax_process">\(p\)</span>) (tức là <span class="math notranslate nohighlight tex2jax_process">\(N^2p + N\)</span>, với <span class="math notranslate nohighlight tex2jax_process">\(N\)</span> là số lượng phương trình và <span class="math notranslate nohighlight tex2jax_process">\(p\)</span> là số lượng độ trễ).</p>
<p>Trong số các chỉ số trên, AIC và BIC là những tiêu chí được sử dụng rộng rãi nhất, nhưng BIC xử phạt (penalize) các bậc cao nặng nề hơn. Đối với kích thước mẫu trung bình và lớn, AIC và FPE về cơ bản là tương đương nhau, nhưng FPE có thể vượt trội hơn AIC đối với kích thước mẫu nhỏ. HQ cũng xử phạt các mô hình bậc cao nặng hơn AIC, nhưng nhẹ hơn so với BIC. Tuy nhiên, trong điều kiện mẫu nhỏ, AIC/FPE có thể hiệu quả hơn BIC và/hoặc HQ trong việc lựa chọn bậc mô hình thực tế.</p>
<p>Có những trường hợp khi AIC và FPE không hiển thị giá trị tối thiểu rõ ràng trên một phạm vi các bậc mô hình hoặc độ dài độ trễ. Trong trường hợp này, có thể xuất hiện một điểm “khuỷu tay” (elbow) rõ rệt khi chúng ta vẽ biểu đồ các giá trị theo bậc mô hình. Điều này có thể gợi ý một bậc mô hình phù hợp.</p>
</section>
</section>
<section id="xay-dung-mo-hinh-var" class="tex2jax_process">
<h2 id="xay-dung-mo-hinh-var-9">Xây dựng mô hình VAR</h2>
<p>Trong phần này, chúng em sẽ trình bày cách sử dụng mô hình VAR để dự báo dữ liệu chất lượng không khí. Các bước thực hiện được liệt kê dưới đây:</p>
<ol class="arabic simple">
<li><p>Kiểm tra tính dừng.</p></li>
<li><p>Chia dữ liệu thành tập huấn luyện (train) và tập kiểm tra (test).</p></li>
<li><p>Lựa chọn bậc VAR <em>p</em> phù hợp.</p></li>
<li><p>Khớp mô hình VAR bậc <em>p</em> trên tập huấn luyện.</p></li>
<li><p>Thực hiện dự báo.</p></li>
<li><p>Đánh giá hiệu suất của mô hình.</p></li>
</ol>
<section id="vi-du-2-du-bao-du-lieu-chat-luong-khong-khi-co-no2-va-rh" class="tex2jax_process">
<h3 id="vi-du-2-du-bao-du-lieu-chat-luong-khong-khi-co-no2-10">Ví dụ 2: Dự báo dữ liệu chất lượng không khí (CO, NO2 và RH)</h3>
<p>Để minh họa, chúng ta xem xét các chuỗi thời gian về khí carbon monoxide (CO), nitrous dioxide (NO2) và độ ẩm tương đối (RH) từ Tập dữ liệu Chất lượng Không khí tính từ ngày 1 tháng 10 năm 2014.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cols</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'CO(GT)'</span><span class="p">,</span> <span class="s1">'NO2(GT)'</span><span class="p">,</span> <span class="s1">'RH'</span><span class="p">]</span>
<span class="n">data_df</span> <span class="o">=</span> <span class="n">aq_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">aq_df</span><span class="o">.</span><span class="n">index</span><span class="o">&gt;</span><span class="s1">'2004-10-01'</span><span class="p">,</span><span class="n">cols</span><span class="p">]</span>
<span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">data_df</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">subplots</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">''</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="images/00a4747dd6bf2e7cca97f32229bd98fb73a209065b3b37414fff5666dbaa9c10.png" src="images/00a4747dd6bf2e7cca97f32229bd98fb73a209065b3b37414fff5666dbaa9c10.png" style="max-width: 100%; height: auto; display: block;">
</div>
</div>
<p><strong>Kiểm tra nhanh trước khi tiến hành xây dựng mô hình…</strong></p>
<p>Để tìm hiểu xem liệu phương pháp đa biến có tốt hơn việc xử lý các tín hiệu riêng biệt như các chuỗi thời gian đơn biến hay không, chúng ta kiểm tra mối quan hệ giữa các biến bằng hàm tương quan chéo (CCF). Mẫu dưới đây hiển thị CCF cho 100 điểm dữ liệu cuối cùng của dữ liệu chất lượng không khí đối với các biến CO, NO2 và RH.</p>
<p><em>CO và NO2</em></p>
<div class="cell docutils container tex2jax_process">
<div class="cell_input docutils container tex2jax_process">
<div class="highlight-ipython3 notranslate tex2jax_process"><div class="highlight tex2jax_process"><pre class="tex2jax_process"><span></span><span class="n">sample_df</span> <span class="o">=</span> <span class="n">data_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">100</span><span class="p">:]</span>
<span class="n">ccf_y1_y2</span> <span class="o">=</span> <span class="n">ccf</span><span class="p">(</span><span class="n">sample_df</span><span class="p">[</span><span class="s1">'CO(GT)'</span><span class="p">],</span> <span class="n">sample_df</span><span class="p">[</span><span class="s1">'NO2(GT)'</span><span class="p">],</span> <span class="n">unbiased</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">ccf_y2_y1</span> <span class="o">=</span> <span class="n">ccf</span><span class="p">(</span><span class="n">sample_df</span><span class="p">[</span><span class="s1">'NO2(GT)'</span><span class="p">],</span> <span class="n">sample_df</span><span class="p">[</span><span class="s1">'CO(GT)'</span><span class="p">],</span> <span class="n">unbiased</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">d</span><span class="o">=</span><span class="mi">1</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">stem</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sample_df</span><span class="p">))[::</span><span class="n">d</span><span class="p">],</span> <span class="n">ccf_y1_y2</span><span class="p">[::</span><span class="n">d</span><span class="p">],</span> <span class="n">linefmt</span><span class="o">=</span><span class="s1">'C1-'</span><span class="p">,</span> <span class="n">markerfmt</span><span class="o">=</span><span class="s1">'C1o'</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">stem</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sample_df</span><span class="p">))[::</span><span class="n">d</span><span class="p">],</span> <span class="n">ccf_y2_y1</span><span class="p">[::</span><span class="n">d</span><span class="p">],</span> <span class="n">linefmt</span><span class="o">=</span><span class="s1">'C1-'</span><span class="p">,</span> <span class="n">markerfmt</span><span class="o">=</span><span class="s1">'C1o'</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1 tex2jax_process">'lag $h$'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1 tex2jax_process">'$\rho_{CO,NO2} (h)$'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1 tex2jax_process">'$\rho_{NO2,CO} (h)$'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="images/e663dd4d791cff8a8216acb416b2238db5d8505f51294850632ca603cb22b085.png" src="images/e663dd4d791cff8a8216acb416b2238db5d8505f51294850632ca603cb22b085.png" style="max-width: 100%; height: auto; display: block;">
</div>
</div>
<p><em>CO và RH</em></p>
<div class="cell docutils container tex2jax_process">
<div class="cell_input docutils container tex2jax_process">
<div class="highlight-ipython3 notranslate tex2jax_process"><div class="highlight tex2jax_process"><pre class="tex2jax_process"><span></span><span class="n">ccf_y1_y2</span> <span class="o">=</span> <span class="n">ccf</span><span class="p">(</span><span class="n">sample_df</span><span class="p">[</span><span class="s1">'CO(GT)'</span><span class="p">],</span> <span class="n">sample_df</span><span class="p">[</span><span class="s1">'RH'</span><span class="p">],</span> <span class="n">unbiased</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">ccf_y2_y1</span> <span class="o">=</span> <span class="n">ccf</span><span class="p">(</span><span class="n">sample_df</span><span class="p">[</span><span class="s1">'RH'</span><span class="p">],</span> <span class="n">sample_df</span><span class="p">[</span><span class="s1">'CO(GT)'</span><span class="p">],</span> <span class="n">unbiased</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">d</span><span class="o">=</span><span class="mi">1</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">stem</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sample_df</span><span class="p">))[::</span><span class="n">d</span><span class="p">],</span> <span class="n">ccf_y1_y2</span><span class="p">[::</span><span class="n">d</span><span class="p">],</span> <span class="n">linefmt</span><span class="o">=</span><span class="s1">'C1-'</span><span class="p">,</span> <span class="n">markerfmt</span><span class="o">=</span><span class="s1">'C1o'</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">stem</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sample_df</span><span class="p">))[::</span><span class="n">d</span><span class="p">],</span> <span class="n">ccf_y2_y1</span><span class="p">[::</span><span class="n">d</span><span class="p">],</span> <span class="n">linefmt</span><span class="o">=</span><span class="s1">'C1-'</span><span class="p">,</span> <span class="n">markerfmt</span><span class="o">=</span><span class="s1">'C1o'</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1 tex2jax_process">'lag $h$'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1 tex2jax_process">'$\rho_{CO,RH} (h)$'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1 tex2jax_process">'$\rho_{RH,CO} (h)$'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="images/a0f4949436e8b2967cd6642d84d18c40ce2a6ebeb81d729160d08380188482f4.png" src="images/a0f4949436e8b2967cd6642d84d18c40ce2a6ebeb81d729160d08380188482f4.png" style="max-width: 100%; height: auto; display: block;">
</div>
</div>
<p><em>RH và NO2</em></p>
<div class="cell docutils container tex2jax_process">
<div class="cell_input docutils container tex2jax_process">
<div class="highlight-ipython3 notranslate tex2jax_process"><div class="highlight tex2jax_process"><pre class="tex2jax_process"><span></span><span class="n">ccf_y1_y2</span> <span class="o">=</span> <span class="n">ccf</span><span class="p">(</span><span class="n">sample_df</span><span class="p">[</span><span class="s1">'RH'</span><span class="p">],</span> <span class="n">sample_df</span><span class="p">[</span><span class="s1">'NO2(GT)'</span><span class="p">],</span> <span class="n">unbiased</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">ccf_y2_y1</span> <span class="o">=</span> <span class="n">ccf</span><span class="p">(</span><span class="n">sample_df</span><span class="p">[</span><span class="s1">'NO2(GT)'</span><span class="p">],</span> <span class="n">sample_df</span><span class="p">[</span><span class="s1">'RH'</span><span class="p">],</span> <span class="n">unbiased</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">d</span><span class="o">=</span><span class="mi">1</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">stem</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sample_df</span><span class="p">))[::</span><span class="n">d</span><span class="p">],</span> <span class="n">ccf_y1_y2</span><span class="p">[::</span><span class="n">d</span><span class="p">],</span> <span class="n">linefmt</span><span class="o">=</span><span class="s1">'C1-'</span><span class="p">,</span> <span class="n">markerfmt</span><span class="o">=</span><span class="s1">'C1o'</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">stem</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sample_df</span><span class="p">))[::</span><span class="n">d</span><span class="p">],</span> <span class="n">ccf_y2_y1</span><span class="p">[::</span><span class="n">d</span><span class="p">],</span> <span class="n">linefmt</span><span class="o">=</span><span class="s1">'C1-'</span><span class="p">,</span> <span class="n">markerfmt</span><span class="o">=</span><span class="s1">'C1o'</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1 tex2jax_process">'lag $h$'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1 tex2jax_process">'$\rho_{RH,NO2} (h)$'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1 tex2jax_process">'$\rho_{NO2,RH} (h)$'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="images/4746784f415d3ac70770b12df63b0dfc92705d10e32d54057a3d743d872e96fb.png" src="images/4746784f415d3ac70770b12df63b0dfc92705d10e32d54057a3d743d872e96fb.png" style="max-width: 100%; height: auto; display: block;">
</div>
</div>
<p><strong>Các quan sát</strong>:</p>
<p>Như được thể hiện trong biểu đồ trên, chúng ta có thể thấy rằng có mối quan hệ giữa:</p>
<ul class="simple">
<li><p>CO và một số giá trị trễ của RH và NO2.</p></li>
<li><p>NO2 và một số giá trị trễ của RH và CO.</p></li>
<li><p>RH và một số giá trị trễ của CO và NO2.</p></li>
</ul>
<p>Điều này cho thấy chúng ta có thể nhận được lợi ích từ phương pháp tiếp cận đa biến, vì vậy chúng ta tiến hành xây dựng mô hình VAR.</p>
<section id="kiem-tra-tinh-dung">
<h4>1. Kiểm tra tính dừng</h4>
<p>Để kiểm tra tính dừng, chúng ta sử dụng kiểm định Kwiatkowski–Phillips–Schmidt–Shin (KPSS) và kiểm định Augmented Dickey-Fuller (ADF). Để dữ liệu phù hợp cho việc lập mô hình VAR, chúng ta cần từng biến trong chuỗi thời gian đa biến phải đạt tính dừng. Trong cả hai kiểm định, chúng ta cần giá trị thống kê kiểm định (test statistic) nhỏ hơn các giá trị tới hạn (critical values) để có thể kết luận rằng một chuỗi thời gian (một biến) là dừng.</p>
<section id="kiem-dinh-kwiatkowskiphillipsschmidtshin-kpss">
<h5>Kiểm định Kwiatkowski–Phillips–Schmidt–Shin (KPSS)</h5>
<p>Nhắc lại: Giả thuyết không là chuỗi thời gian quan sát được đạt tính dừng xung quanh một xu thế xác định (tức là dừng theo xu thế - trend-stationary), đối nghịch với giả thuyết đối là có một nghiệm đơn vị (unit root).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">test_stat</span><span class="p">,</span> <span class="n">p_val</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
<span class="n">cv_1pct</span><span class="p">,</span> <span class="n">cv_2p5pct</span><span class="p">,</span> <span class="n">cv_5pct</span><span class="p">,</span> <span class="n">cv_10pct</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">data_df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span> 
    <span class="n">kpss_res</span> <span class="o">=</span> <span class="n">kpss</span><span class="p">(</span><span class="n">data_df</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">(),</span> <span class="n">regression</span><span class="o">=</span><span class="s1">'ct'</span><span class="p">)</span>
    <span class="n">test_stat</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">kpss_res</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">p_val</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">kpss_res</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">cv_1pct</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">kpss_res</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="s1">'1%'</span><span class="p">])</span>
    <span class="n">cv_2p5pct</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">kpss_res</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="s1">'1%'</span><span class="p">])</span>
    <span class="n">cv_5pct</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">kpss_res</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="s1">'5%'</span><span class="p">])</span>
    <span class="n">cv_10pct</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">kpss_res</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="s1">'10%'</span><span class="p">])</span>
<span class="n">kpss_res_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">'Test statistic'</span><span class="p">:</span> <span class="n">test_stat</span><span class="p">,</span> 
                           <span class="s1">'p-value'</span><span class="p">:</span> <span class="n">p_val</span><span class="p">,</span> 
                           <span class="s1">'Critical value - 1%'</span><span class="p">:</span> <span class="n">cv_1pct</span><span class="p">,</span>
                           <span class="s1">'Critical value - 2.5%'</span><span class="p">:</span> <span class="n">cv_2p5pct</span><span class="p">,</span>
                           <span class="s1">'Critical value - 5%'</span><span class="p">:</span> <span class="n">cv_5pct</span><span class="p">,</span>
                           <span class="s1">'Critical value - 10%'</span><span class="p">:</span> <span class="n">cv_10pct</span><span class="p">},</span> 
                         <span class="n">index</span><span class="o">=</span><span class="n">data_df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
<span class="n">kpss_res_df</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<div class="table-container"><table class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>CO(GT)</th>
      <th>NO2(GT)</th>
      <th>RH</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Test statistic</th>
      <td>0.0702</td>
      <td>0.3239</td>
      <td>0.1149</td>
    </tr>
    <tr>
      <th>p-value</th>
      <td>0.1000</td>
      <td>0.0100</td>
      <td>0.1000</td>
    </tr>
    <tr>
      <th>Critical value - 1%</th>
      <td>0.2160</td>
      <td>0.2160</td>
      <td>0.2160</td>
    </tr>
    <tr>
      <th>Critical value - 2.5%</th>
      <td>0.2160</td>
      <td>0.2160</td>
      <td>0.2160</td>
    </tr>
    <tr>
      <th>Critical value - 5%</th>
      <td>0.1460</td>
      <td>0.1460</td>
      <td>0.1460</td>
    </tr>
    <tr>
      <th>Critical value - 10%</th>
      <td>0.1190</td>
      <td>0.1190</td>
      <td>0.1190</td>
    </tr>
  </tbody>
</table></div>
</div></div></div>
</div>
<p><strong>Các quan sát</strong>:</p>
<p>Từ kết quả kiểm định KPSS, các biến CO và RH đạt tính dừng.</p>
</section>
<section id="kiem-dinh-augmented-dickey-fuller-adf">
<h5>Kiểm định Augmented Dickey-Fuller (ADF)</h5>
<p>Nhắc lại: Giả thuyết không là có sự hiện diện của một nghiệm đơn vị (unit root) trong mẫu chuỗi thời gian, đối nghịch với giả thuyết đối là chuỗi thời gian đó đạt tính dừng.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">test_stat</span><span class="p">,</span> <span class="n">p_val</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
<span class="n">cv_1pct</span><span class="p">,</span> <span class="n">cv_5pct</span><span class="p">,</span> <span class="n">cv_10pct</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">data_df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span> 
    <span class="n">adf_res</span> <span class="o">=</span> <span class="n">adfuller</span><span class="p">(</span><span class="n">data_df</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">())</span>
    <span class="n">test_stat</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">adf_res</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">p_val</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">adf_res</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">cv_1pct</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">adf_res</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="s1">'1%'</span><span class="p">])</span>
    <span class="n">cv_5pct</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">adf_res</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="s1">'5%'</span><span class="p">])</span>
    <span class="n">cv_10pct</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">adf_res</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="s1">'10%'</span><span class="p">])</span>
<span class="n">adf_res_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">'Test statistic'</span><span class="p">:</span> <span class="n">test_stat</span><span class="p">,</span> 
                           <span class="s1">'p-value'</span><span class="p">:</span> <span class="n">p_val</span><span class="p">,</span> 
                           <span class="s1">'Critical value - 1%'</span><span class="p">:</span> <span class="n">cv_1pct</span><span class="p">,</span>
                           <span class="s1">'Critical value - 5%'</span><span class="p">:</span> <span class="n">cv_5pct</span><span class="p">,</span>
                           <span class="s1">'Critical value - 10%'</span><span class="p">:</span> <span class="n">cv_10pct</span><span class="p">},</span> 
                         <span class="n">index</span><span class="o">=</span><span class="n">data_df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
<span class="n">adf_res_df</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<div class="table-container"><table class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>CO(GT)</th>
      <th>NO2(GT)</th>
      <th>RH</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Test statistic</th>
      <td>-7.0195</td>
      <td>-6.7695</td>
      <td>-6.8484</td>
    </tr>
    <tr>
      <th>p-value</th>
      <td>0.0000</td>
      <td>0.0000</td>
      <td>0.0000</td>
    </tr>
    <tr>
      <th>Critical value - 1%</th>
      <td>-3.4318</td>
      <td>-3.4318</td>
      <td>-3.4318</td>
    </tr>
    <tr>
      <th>Critical value - 5%</th>
      <td>-2.8622</td>
      <td>-2.8622</td>
      <td>-2.8622</td>
    </tr>
    <tr>
      <th>Critical value - 10%</th>
      <td>-2.5671</td>
      <td>-2.5671</td>
      <td>-2.5671</td>
    </tr>
  </tbody>
</table></div>
</div></div></div>
</div>
<p><strong>Các quan sát</strong>:</p>
<p>Từ kết quả kiểm định ADF, cả ba biến CO, NO2 và RH đều đạt tính dừng.</p>
</section>
</section>
<section id="chia-du-lieu-thanh-tap-huan-luyen-train-va-tap-kiem-tra-test">
<h4>2. Chia dữ liệu thành tập huấn luyện (train) và tập kiểm tra (test)</h4>
<p>Chúng ta sử dụng tập dữ liệu từ ngày 01 tháng 10 năm 2014 để dự báo 24 điểm cuối cùng (tương ứng với 24 giờ/1 ngày) trong tập dữ liệu.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">forecast_length</span> <span class="o">=</span> <span class="mi">24</span> 
<span class="n">train_df</span><span class="p">,</span> <span class="n">test_df</span> <span class="o">=</span> <span class="n">data_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="o">-</span><span class="n">forecast_length</span><span class="p">],</span> <span class="n">data_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="n">forecast_length</span><span class="p">:]</span>
<span class="n">test_df</span> <span class="o">=</span> <span class="n">test_df</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">test_df</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="o">~</span><span class="n">test_df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">'-d'</span><span class="p">)])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">train_df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">'../data/AirQualityUCI/train_data.csv'</span><span class="p">)</span>
<span class="n">test_df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">'../data/AirQualityUCI/test_data.csv'</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">train_df</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">subplots</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">''</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="images/683c2d663163dad9fbca7778a030fde67505c90ad4d441a43976265c1beddcbd.png" src="images/683c2d663163dad9fbca7778a030fde67505c90ad4d441a43976265c1beddcbd.png" style="max-width: 100%; height: auto; display: block;">
</div>
</div>
</section>
<section id="lua-chon-bac-p" class="tex2jax_process">
<h4>3. Lựa chọn bậc <em>p</em></h4>
<p>Chúng ta tính toán các tiêu chí thông tin đa biến khác nhau (AIC, BIC, HQIC) và FPE. Sau đó, chúng ta sẽ chọn bộ tham số bậc tương ứng với các giá trị thấp nhất.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">aic</span><span class="p">,</span> <span class="n">bic</span><span class="p">,</span> <span class="n">fpe</span><span class="p">,</span> <span class="n">hqic</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">VAR</span><span class="p">(</span><span class="n">train_df</span><span class="p">)</span> 
<span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">60</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">p</span><span class="p">:</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="n">aic</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">aic</span><span class="p">)</span>
    <span class="n">bic</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">bic</span><span class="p">)</span>
    <span class="n">fpe</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">fpe</span><span class="p">)</span>
    <span class="n">hqic</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">hqic</span><span class="p">)</span>
<span class="n">lags_metrics_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">'AIC'</span><span class="p">:</span> <span class="n">aic</span><span class="p">,</span> 
                                <span class="s1">'BIC'</span><span class="p">:</span> <span class="n">bic</span><span class="p">,</span> 
                                <span class="s1">'HQIC'</span><span class="p">:</span> <span class="n">hqic</span><span class="p">,</span>
                                <span class="s1">'FPE'</span><span class="p">:</span> <span class="n">fpe</span><span class="p">},</span> 
                               <span class="n">index</span><span class="o">=</span><span class="n">p</span><span class="p">)</span>    
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">lags_metrics_df</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">subplots</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">'o'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="images/44b467ec82542518d90f41ce7a3f23559f08ff117a190bfe94ad82e280c7881d.png" src="images/44b467ec82542518d90f41ce7a3f23559f08ff117a190bfe94ad82e280c7881d.png" style="max-width: 100%; height: auto; display: block;">
</div>
</div>
<p><strong>Các quan sát</strong>:</p>
<p class="tex2jax_process">Chúng ta thấy rằng BIC và HQIC đạt giá trị thấp nhất tại <span class="math notranslate nohighlight tex2jax_process">\(p=26\)</span>. Đồng thời, chúng ta cũng quan sát thấy một điểm “khuỷu tay” (elbow) trên biểu đồ của AIC và FPE, do đó chúng ta lựa chọn số lượng độ trễ là 26.</p>
</section>
<section id="khop-mo-hinh-var-voi-bac-da-chon">
<h4>3. Khớp mô hình VAR với bậc đã chọn</h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>
<span class="n">var_model</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="mi">26</span><span class="p">)</span>
<span class="n">var_model</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>CPU times: user 401 ms, sys: 39.9 ms, total: 441 ms
Wall time: 202 ms
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Summary of Regression Results   
==================================
Model:                         VAR
Method:                        OLS
Date:           Sun, 21, Feb, 2021
Time:                     00:47:42
--------------------------------------------------------------------
No. of Equations:         3.00000    BIC:                    7.42717
Nobs:                     4404.00    HQIC:                   7.20458
Log likelihood:          -34107.4    FPE:                    1191.88
AIC:                      7.08328    Det(Omega_mle):         1129.97
--------------------------------------------------------------------
Results for equation CO(GT)
==============================================================================
                 coefficient       std. error           t-stat            prob
------------------------------------------------------------------------------
const               0.241332         0.069966            3.449           0.001
L1.CO(GT)           0.961418         0.019229           49.999           0.000
L1.NO2(GT)          0.001992         0.000713            2.794           0.005
L1.RH               0.009321         0.002735            3.409           0.001
L2.CO(GT)          -0.279491         0.026156          -10.686           0.000
L2.NO2(GT)          0.000661         0.000970            0.682           0.495
L2.RH              -0.017300         0.004278           -4.044           0.000
L3.CO(GT)           0.098032         0.026251            3.734           0.000
L3.NO2(GT)         -0.000165         0.000970           -0.170           0.865
L3.RH               0.012764         0.004352            2.933           0.003
L4.CO(GT)          -0.001012         0.026285           -0.038           0.969
L4.NO2(GT)         -0.001148         0.000966           -1.189           0.234
L4.RH              -0.006423         0.004354           -1.475           0.140
L5.CO(GT)           0.054358         0.026291            2.068           0.039
L5.NO2(GT)         -0.001218         0.000966           -1.261           0.207
L5.RH               0.000664         0.004353            0.153           0.879
L6.CO(GT)          -0.017663         0.026308           -0.671           0.502
L6.NO2(GT)          0.000372         0.000966            0.385           0.700
L6.RH               0.000884         0.004351            0.203           0.839
L7.CO(GT)           0.004448         0.026302            0.169           0.866
L7.NO2(GT)          0.000921         0.000967            0.953           0.340
L7.RH              -0.000964         0.004353           -0.221           0.825
L8.CO(GT)          -0.001457         0.026288           -0.055           0.956
L8.NO2(GT)          0.000736         0.000968            0.760           0.447
L8.RH              -0.002357         0.004356           -0.541           0.588
L9.CO(GT)           0.018534         0.026296            0.705           0.481
L9.NO2(GT)         -0.001551         0.000969           -1.601           0.109
L9.RH               0.004720         0.004361            1.082           0.279
L10.CO(GT)         -0.003435         0.026289           -0.131           0.896
L10.NO2(GT)         0.001457         0.000969            1.503           0.133
L10.RH              0.003194         0.004366            0.732           0.464
L11.CO(GT)         -0.021526         0.026286           -0.819           0.413
L11.NO2(GT)        -0.001094         0.000969           -1.128           0.259
L11.RH             -0.001129         0.004367           -0.259           0.796
L12.CO(GT)          0.066587         0.026287            2.533           0.011
L12.NO2(GT)        -0.000285         0.000971           -0.293           0.769
L12.RH             -0.002315         0.004369           -0.530           0.596
L13.CO(GT)         -0.076568         0.026287           -2.913           0.004
L13.NO2(GT)         0.000551         0.000971            0.567           0.571
L13.RH              0.004622         0.004370            1.058           0.290
L14.CO(GT)          0.100874         0.026293            3.837           0.000
L14.NO2(GT)        -0.003074         0.000971           -3.165           0.002
L14.RH              0.001720         0.004371            0.394           0.694
L15.CO(GT)         -0.039783         0.026318           -1.512           0.131
L15.NO2(GT)         0.000926         0.000971            0.953           0.340
L15.RH             -0.002928         0.004370           -0.670           0.503
L16.CO(GT)          0.009289         0.026276            0.354           0.724
L16.NO2(GT)         0.000818         0.000969            0.845           0.398
L16.RH             -0.001466         0.004369           -0.336           0.737
L17.CO(GT)         -0.030972         0.026264           -1.179           0.238
L17.NO2(GT)         0.000273         0.000969            0.281           0.778
L17.RH              0.000574         0.004369            0.131           0.895
L18.CO(GT)          0.021964         0.026242            0.837           0.403
L18.NO2(GT)        -0.001183         0.000968           -1.222           0.222
L18.RH              0.003188         0.004366            0.730           0.465
L19.CO(GT)          0.048666         0.026200            1.858           0.063
L19.NO2(GT)        -0.000539         0.000966           -0.558           0.577
L19.RH             -0.010088         0.004362           -2.313           0.021
L20.CO(GT)         -0.065842         0.026213           -2.512           0.012
L20.NO2(GT)         0.000847         0.000965            0.878           0.380
L20.RH              0.008736         0.004363            2.002           0.045
L21.CO(GT)         -0.032047         0.026233           -1.222           0.222
L21.NO2(GT)         0.001082         0.000964            1.122           0.262
L21.RH             -0.004805         0.004360           -1.102           0.270
L22.CO(GT)          0.050969         0.026220            1.944           0.052
L22.NO2(GT)        -0.000471         0.000964           -0.489           0.625
L22.RH              0.000472         0.004360            0.108           0.914
L23.CO(GT)          0.071433         0.026226            2.724           0.006
L23.NO2(GT)         0.001170         0.000964            1.214           0.225
L23.RH             -0.003465         0.004361           -0.794           0.427
L24.CO(GT)          0.198774         0.026160            7.598           0.000
L24.NO2(GT)        -0.000280         0.000968           -0.289           0.772
L24.RH              0.001856         0.004361            0.425           0.670
L25.CO(GT)         -0.156857         0.026043           -6.023           0.000
L25.NO2(GT)         0.000666         0.000967            0.689           0.491
L25.RH              0.000979         0.004290            0.228           0.820
L26.CO(GT)         -0.047697         0.019186           -2.486           0.013
L26.NO2(GT)        -0.001958         0.000710           -2.757           0.006
L26.RH             -0.000747         0.002746           -0.272           0.786
==============================================================================

Results for equation NO2(GT)
==============================================================================
                 coefficient       std. error           t-stat            prob
------------------------------------------------------------------------------
const              12.417213         1.871552            6.635           0.000
L1.CO(GT)           1.600229         0.514359            3.111           0.002
L1.NO2(GT)          0.953169         0.019069           49.986           0.000
L1.RH               0.239537         0.073150            3.275           0.001
L2.CO(GT)          -2.404892         0.699653           -3.437           0.001
L2.NO2(GT)         -0.096250         0.025935           -3.711           0.000
L2.RH              -0.332820         0.114442           -2.908           0.004
L3.CO(GT)           0.154091         0.702192            0.219           0.826
L3.NO2(GT)          0.018241         0.025946            0.703           0.482
L3.RH               0.180558         0.116422            1.551           0.121
L4.CO(GT)           1.160555         0.703122            1.651           0.099
L4.NO2(GT)         -0.065148         0.025831           -2.522           0.012
L4.RH              -0.149770         0.116468           -1.286           0.198
L5.CO(GT)          -0.209355         0.703264           -0.298           0.766
L5.NO2(GT)          0.007011         0.025834            0.271           0.786
L5.RH               0.023622         0.116443            0.203           0.839
L6.CO(GT)           0.742858         0.703728            1.056           0.291
L6.NO2(GT)         -0.029688         0.025847           -1.149           0.251
L6.RH               0.014889         0.116384            0.128           0.898
L7.CO(GT)          -0.535398         0.703562           -0.761           0.447
L7.NO2(GT)          0.089765         0.025857            3.472           0.001
L7.RH              -0.106262         0.116432           -0.913           0.361
L8.CO(GT)          -1.025553         0.703193           -1.458           0.145
L8.NO2(GT)         -0.034196         0.025895           -1.321           0.187
L8.RH               0.127190         0.116517            1.092           0.275
L9.CO(GT)           0.313129         0.703395            0.445           0.656
L9.NO2(GT)          0.005236         0.025910            0.202           0.840
L9.RH              -0.136264         0.116667           -1.168           0.243
L10.CO(GT)         -0.507195         0.703213           -0.721           0.471
L10.NO2(GT)         0.000967         0.025922            0.037           0.970
L10.RH              0.209375         0.116786            1.793           0.073
L11.CO(GT)         -1.319501         0.703135           -1.877           0.061
L11.NO2(GT)         0.069145         0.025930            2.667           0.008
L11.RH             -0.053156         0.116828           -0.455           0.649
L12.CO(GT)          2.602906         0.703181            3.702           0.000
L12.NO2(GT)        -0.076889         0.025968           -2.961           0.003
L12.RH             -0.044469         0.116867           -0.381           0.704
L13.CO(GT)         -2.098667         0.703156           -2.985           0.003
L13.NO2(GT)         0.068250         0.025986            2.626           0.009
L13.RH              0.164246         0.116893            1.405           0.160
L14.CO(GT)          1.141015         0.703317            1.622           0.105
L14.NO2(GT)        -0.077485         0.025985           -2.982           0.003
L14.RH              0.121439         0.116918            1.039           0.299
L15.CO(GT)          0.157231         0.704010            0.223           0.823
L15.NO2(GT)         0.016822         0.025982            0.647           0.517
L15.RH             -0.173595         0.116888           -1.485           0.138
L16.CO(GT)          0.878201         0.702861            1.249           0.211
L16.NO2(GT)         0.003234         0.025923            0.125           0.901
L16.RH             -0.029109         0.116858           -0.249           0.803
L17.CO(GT)         -1.418159         0.702559           -2.019           0.044
L17.NO2(GT)         0.016251         0.025913            0.627           0.531
L17.RH             -0.015862         0.116863           -0.136           0.892
L18.CO(GT)          0.655452         0.701962            0.934           0.350
L18.NO2(GT)        -0.021180         0.025901           -0.818           0.414
L18.RH              0.128568         0.116801            1.101           0.271
L19.CO(GT)         -0.024839         0.700835           -0.035           0.972
L19.NO2(GT)         0.001731         0.025844            0.067           0.947
L19.RH             -0.247871         0.116687           -2.124           0.034
L20.CO(GT)         -0.810637         0.701198           -1.156           0.248
L20.NO2(GT)         0.008661         0.025806            0.336           0.737
L20.RH              0.082541         0.116699            0.707           0.479
L21.CO(GT)         -0.268031         0.701722           -0.382           0.702
L21.NO2(GT)         0.006716         0.025794            0.260           0.795
L21.RH             -0.148403         0.116634           -1.272           0.203
L22.CO(GT)          0.551561         0.701384            0.786           0.432
L22.NO2(GT)         0.029776         0.025786            1.155           0.248
L22.RH              0.137999         0.116639            1.183           0.237
L23.CO(GT)          0.396023         0.701541            0.565           0.572
L23.NO2(GT)         0.141030         0.025786            5.469           0.000
L23.RH             -0.095500         0.116666           -0.819           0.413
L24.CO(GT)          0.359015         0.699771            0.513           0.608
L24.NO2(GT)         0.081228         0.025886            3.138           0.002
L24.RH              0.027786         0.116658            0.238           0.812
L25.CO(GT)         -1.491610         0.696641           -2.141           0.032
L25.NO2(GT)        -0.067370         0.025857           -2.605           0.009
L25.RH             -0.015628         0.114756           -0.136           0.892
L26.CO(GT)          0.583311         0.513221            1.137           0.256
L26.NO2(GT)        -0.100912         0.018999           -5.311           0.000
L26.RH              0.021928         0.073465            0.298           0.765
==============================================================================

Results for equation RH
==============================================================================
                 coefficient       std. error           t-stat            prob
------------------------------------------------------------------------------
const               1.708989         0.393111            4.347           0.000
L1.CO(GT)          -0.043025         0.108039           -0.398           0.690
L1.NO2(GT)         -0.010353         0.004005           -2.585           0.010
L1.RH               1.209022         0.015365           78.688           0.000
L2.CO(GT)          -0.237686         0.146959           -1.617           0.106
L2.NO2(GT)          0.010539         0.005448            1.935           0.053
L2.RH              -0.290694         0.024038          -12.093           0.000
L3.CO(GT)           0.154914         0.147492            1.050           0.294
L3.NO2(GT)         -0.002859         0.005450           -0.525           0.600
L3.RH               0.052192         0.024454            2.134           0.033
L4.CO(GT)           0.095980         0.147688            0.650           0.516
L4.NO2(GT)          0.003434         0.005426            0.633           0.527
L4.RH              -0.021893         0.024464           -0.895           0.371
L5.CO(GT)          -0.035423         0.147718           -0.240           0.810
L5.NO2(GT)         -0.002389         0.005426           -0.440           0.660
L5.RH               0.037941         0.024458            1.551           0.121
L6.CO(GT)          -0.040464         0.147815           -0.274           0.784
L6.NO2(GT)          0.001410         0.005429            0.260           0.795
L6.RH              -0.074252         0.024446           -3.037           0.002
L7.CO(GT)          -0.012767         0.147780           -0.086           0.931
L7.NO2(GT)          0.007474         0.005431            1.376           0.169
L7.RH               0.040664         0.024456            1.663           0.096
L8.CO(GT)           0.080673         0.147703            0.546           0.585
L8.NO2(GT)          0.001860         0.005439            0.342           0.732
L8.RH              -0.076619         0.024474           -3.131           0.002
L9.CO(GT)           0.047686         0.147745            0.323           0.747
L9.NO2(GT)         -0.004802         0.005442           -0.882           0.378
L9.RH               0.063403         0.024505            2.587           0.010
L10.CO(GT)          0.050348         0.147707            0.341           0.733
L10.NO2(GT)         0.004929         0.005445            0.905           0.365
L10.RH             -0.044706         0.024530           -1.822           0.068
L11.CO(GT)          0.117202         0.147691            0.794           0.427
L11.NO2(GT)        -0.002450         0.005446           -0.450           0.653
L11.RH              0.050771         0.024539            2.069           0.039
L12.CO(GT)          0.081156         0.147700            0.549           0.583
L12.NO2(GT)        -0.002690         0.005454           -0.493           0.622
L12.RH             -0.040349         0.024547           -1.644           0.100
L13.CO(GT)         -0.028788         0.147695           -0.195           0.845
L13.NO2(GT)         0.000768         0.005458            0.141           0.888
L13.RH              0.020414         0.024553            0.831           0.406
L14.CO(GT)         -0.078942         0.147729           -0.534           0.593
L14.NO2(GT)        -0.002734         0.005458           -0.501           0.616
L14.RH             -0.000282         0.024558           -0.011           0.991
L15.CO(GT)         -0.144161         0.147874           -0.975           0.330
L15.NO2(GT)         0.002442         0.005457            0.448           0.654
L15.RH              0.030373         0.024552            1.237           0.216
L16.CO(GT)         -0.001777         0.147633           -0.012           0.990
L16.NO2(GT)         0.002061         0.005445            0.379           0.705
L16.RH             -0.049313         0.024546           -2.009           0.045
L17.CO(GT)          0.046799         0.147569            0.317           0.751
L17.NO2(GT)        -0.007569         0.005443           -1.391           0.164
L17.RH              0.033906         0.024547            1.381           0.167
L18.CO(GT)         -0.080688         0.147444           -0.547           0.584
L18.NO2(GT)         0.006073         0.005440            1.116           0.264
L18.RH              0.006116         0.024533            0.249           0.803
L19.CO(GT)          0.269110         0.147207            1.828           0.068
L19.NO2(GT)        -0.004253         0.005429           -0.784           0.433
L19.RH             -0.011621         0.024510           -0.474           0.635
L20.CO(GT)         -0.324511         0.147284           -2.203           0.028
L20.NO2(GT)         0.000789         0.005420            0.145           0.884
L20.RH              0.041952         0.024512            1.711           0.087
L21.CO(GT)          0.177418         0.147394            1.204           0.229
L21.NO2(GT)         0.005398         0.005418            0.996           0.319
L21.RH             -0.037378         0.024499           -1.526           0.127
L22.CO(GT)          0.124107         0.147323            0.842           0.400
L22.NO2(GT)        -0.006135         0.005416           -1.133           0.257
L22.RH              0.041857         0.024500            1.708           0.088
L23.CO(GT)         -0.041076         0.147356           -0.279           0.780
L23.NO2(GT)        -0.005205         0.005416           -0.961           0.337
L23.RH              0.047960         0.024505            1.957           0.050
L24.CO(GT)          0.171936         0.146984            1.170           0.242
L24.NO2(GT)         0.003821         0.005437            0.703           0.482
L24.RH              0.010637         0.024503            0.434           0.664
L25.CO(GT)         -0.302108         0.146326           -2.065           0.039
L25.NO2(GT)         0.007458         0.005431            1.373           0.170
L25.RH             -0.034121         0.024104           -1.416           0.157
L26.CO(GT)          0.150202         0.107800            1.393           0.164
L26.NO2(GT)        -0.008683         0.003991           -2.176           0.030
L26.RH             -0.041247         0.015431           -2.673           0.008
==============================================================================

Correlation matrix of residuals
             CO(GT)   NO2(GT)        RH
CO(GT)     1.000000  0.606004  0.150771
NO2(GT)    0.606004  1.000000  0.078143
RH         0.150771  0.078143  1.000000
</pre></div>
</div>
</div>
</div>
</section>
<section id="thuc-hien-du-bao">
<h4>4. Thực hiện dự báo</h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">forecast_var</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">var_model</span><span class="o">.</span><span class="n">forecast</span><span class="p">(</span><span class="n">train_df</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> 
                                              <span class="n">steps</span><span class="o">=</span><span class="n">forecast_length</span><span class="p">),</span> 
                           <span class="n">columns</span><span class="o">=</span><span class="n">train_df</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> 
                           <span class="n">index</span><span class="o">=</span><span class="n">test_df</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
<span class="n">forecast_var</span> <span class="o">=</span> <span class="n">forecast_var</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="n">c</span><span class="p">:</span> <span class="n">c</span><span class="o">+</span><span class="s1">'-VAR'</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">forecast_var</span><span class="o">.</span><span class="n">columns</span><span class="p">})</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">train_df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">15</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
    <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">train_df</span><span class="p">[[</span><span class="n">c</span><span class="p">]],</span> <span class="n">forecast_var</span><span class="p">[[</span><span class="n">c</span><span class="o">+</span><span class="s1">'-VAR'</span><span class="p">]]],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="s1">'2005-03-01'</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">''</span><span class="p">)</span>
<span class="c1">#     plt.tight_layout()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="images/290402741f746bf7b41673f89bc40ab994324508eb97a40a4b1fd2c765d17fce.png" src="images/290402741f746bf7b41673f89bc40ab994324508eb97a40a4b1fd2c765d17fce.png" style="max-width: 100%; height: auto; display: block;">
<img alt="images/133e8fe741f3e675d19c0193aab27f2f2f4b39364467cc02652086a33812a913.png" src="images/133e8fe741f3e675d19c0193aab27f2f2f4b39364467cc02652086a33812a913.png" style="max-width: 100%; height: auto; display: block;">
<img alt="images/bc0422bd93a4e88bc82d170f64ccfd30dc9f7309d47dd175b11e38152b4895cf.png" src="images/bc0422bd93a4e88bc82d170f64ccfd30dc9f7309d47dd175b11e38152b4895cf.png" style="max-width: 100%; height: auto; display: block;">
</div>
</div>
</section>
<section id="danh-gia-hieu-suat-so-sanh-voi-mo-hinh-arima">
<h4>Đánh giá hiệu suất: So sánh với mô hình ARIMA</h4>
<p>Khi sử dụng ARIMA, chúng ta coi mỗi biến là một chuỗi thời gian đơn biến riêng biệt và thực hiện dự báo cho từng biến: một mô hình cho CO, một cho NO2 và một cho RH.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># For model order selection, refer to Chapter 1</span>
<span class="n">selected_order</span> <span class="o">=</span> <span class="p">{</span><span class="s1">'CO(GT)'</span><span class="p">:</span> <span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)],</span>
                  <span class="s1">'NO2(GT)'</span><span class="p">:</span> <span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)],</span>
                  <span class="s1">'RH'</span><span class="p">:</span> <span class="p">[(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)]}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>
<span class="n">forecast_arima</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">cols</span><span class="p">:</span>
    <span class="n">forecast_arima</span><span class="p">[</span><span class="n">c</span><span class="o">+</span><span class="s1">'-ARIMA'</span><span class="p">]</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">forecast_arima</span><span class="p">(</span><span class="n">train_df</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> 
                                                      <span class="n">test_df</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> 
                                                      <span class="n">order</span><span class="o">=</span><span class="n">selected_order</span><span class="p">[</span><span class="n">c</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
<span class="n">forecast_arima</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">forecast_arima</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">forecast_var</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
<span class="n">forecast_arima</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>CPU times: user 4.32 s, sys: 268 ms, total: 4.58 s
Wall time: 1.48 s
</pre></div>
</div>
<div class="output text_html"><div>
<style>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<div class="table-container"><table class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>CO(GT)-ARIMA</th>
      <th>NO2(GT)-ARIMA</th>
      <th>RH-ARIMA</th>
    </tr>
    <tr>
      <th>Date_Time</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2005-04-03 15:00:00</th>
      <td>0.999865</td>
      <td>87.002935</td>
      <td>14.502893</td>
    </tr>
    <tr>
      <th>2005-04-03 16:00:00</th>
      <td>0.999729</td>
      <td>87.005870</td>
      <td>16.743239</td>
    </tr>
    <tr>
      <th>2005-04-03 17:00:00</th>
      <td>0.999594</td>
      <td>87.008806</td>
      <td>19.253414</td>
    </tr>
    <tr>
      <th>2005-04-03 18:00:00</th>
      <td>0.999458</td>
      <td>87.011741</td>
      <td>21.715709</td>
    </tr>
    <tr>
      <th>2005-04-03 19:00:00</th>
      <td>0.999323</td>
      <td>87.014676</td>
      <td>23.974483</td>
    </tr>
  </tbody>
</table></div>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">forecasts</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">forecast_arima</span><span class="p">,</span> <span class="n">forecast_var</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">cols</span><span class="p">:</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">plot_forecasts_static</span><span class="p">(</span><span class="n">train_df</span><span class="o">=</span><span class="n">train_df</span><span class="p">,</span>
                                          <span class="n">test_df</span><span class="o">=</span><span class="n">test_df</span><span class="p">,</span> 
                                          <span class="n">forecast_df</span><span class="o">=</span><span class="n">forecasts</span><span class="p">,</span> 
                                          <span class="n">column_name</span><span class="o">=</span><span class="n">c</span><span class="p">,</span>
                                          <span class="n">min_train_date</span><span class="o">=</span><span class="s1">'2005-04-01'</span><span class="p">,</span> 
                                          <span class="n">suffix</span><span class="o">=</span><span class="p">[</span><span class="s1">'-VAR'</span><span class="p">,</span> <span class="s1">'-ARIMA'</span><span class="p">],</span>
                                          <span class="n">title</span><span class="o">=</span><span class="n">c</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="images/cbc44e046acc3fecaddfeef37596c052720d644aa0454dfd878dd6901cbcb23f.png" src="images/cbc44e046acc3fecaddfeef37596c052720d644aa0454dfd878dd6901cbcb23f.png" style="max-width: 100%; height: auto; display: block;">
<img alt="images/acd6c2e6a36fb41f4513777d4def6766adb0f3004e2958c539ad5f5c9a14eddf.png" src="images/acd6c2e6a36fb41f4513777d4def6766adb0f3004e2958c539ad5f5c9a14eddf.png" style="max-width: 100%; height: auto; display: block;">
<img alt="images/2b072182fb7f5ed2c5fe27cb0a4e95a74c62af458d0b6834c852681a90507af3.png" src="images/2b072182fb7f5ed2c5fe27cb0a4e95a74c62af458d0b6834c852681a90507af3.png" style="max-width: 100%; height: auto; display: block;">
</div>
</div>
<p><strong>Chỉ số hiệu suất</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">utils</span><span class="o">.</span><span class="n">test_performance_metrics</span><span class="p">(</span><span class="n">test_df</span><span class="p">,</span> <span class="n">forecast_var</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="s1">'-VAR'</span><span class="p">),</span>
           <span class="n">utils</span><span class="o">.</span><span class="n">test_performance_metrics</span><span class="p">(</span><span class="n">test_df</span><span class="p">,</span> <span class="n">forecast_arima</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="s1">'-ARIMA'</span><span class="p">)],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<div class="table-container"><table class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>CO(GT)-VAR</th>
      <th>NO2(GT)-VAR</th>
      <th>RH-VAR</th>
      <th>CO(GT)-ARIMA</th>
      <th>NO2(GT)-ARIMA</th>
      <th>RH-ARIMA</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>MAE</th>
      <td>0.685005</td>
      <td>31.687612</td>
      <td>9.748883</td>
      <td>1.057097</td>
      <td>59.283376</td>
      <td>16.239017</td>
    </tr>
    <tr>
      <th>MSE</th>
      <td>1.180781</td>
      <td>1227.046604</td>
      <td>111.996306</td>
      <td>2.163021</td>
      <td>4404.904459</td>
      <td>333.622140</td>
    </tr>
    <tr>
      <th>MAPE</th>
      <td>43.508500</td>
      <td>29.811066</td>
      <td>35.565987</td>
      <td>56.960617</td>
      <td>46.190671</td>
      <td>51.199023</td>
    </tr>
  </tbody>
</table></div>
</div></div></div>
</div>
<p><strong>Các quan sát</strong>:</p>
<ul class="simple">
<li><p>MAE: Dự báo bằng mô hình VAR có sai số thấp hơn ARIMA đối với CO và NO2, nhưng không tốt hơn đối với RH.</p></li>
<li><p>MSE: Mô hình VAR cho sai số thấp hơn ARIMA đối với tất cả các biến (CO, NO2 và RH).</p></li>
<li><p>MAPE: Mô hình VAR cho sai số thấp hơn ARIMA đối với tất cả các biến (CO, NO2 và RH).</p></li>
<li><p>Thời gian huấn luyện: VAR có thời gian huấn luyện ngắn hơn đáng kể so với ARIMA (thời gian chạy &lt; 0,1 giây đối với VAR, trong khi ARIMA mất khoảng ~20 giây).</p></li>
</ul>
</section>
</section>
</section>
<section id="phan-tich-var-cau-truc" class="tex2jax_process">
<h2 id="phan-tich-var-cau-truc-11">Phân tích VAR cấu trúc</h2>
<p>Bên cạnh dự báo, các mô hình VAR còn được sử dụng cho suy luận cấu trúc và phân tích chính sách. Trong kinh tế học vĩ mô, phân tích cấu trúc này đã được sử dụng rộng rãi để nghiên cứu các cơ chế truyền dẫn của các cú sốc kinh tế vĩ mô (ví dụ: cú sốc tiền tệ, cú sốc tài chính) và kiểm định các lý thuyết kinh tế. Có những giả định cụ thể được áp đặt về cấu trúc nhân quả của bộ dữ liệu, và các tác động nhân quả thu được của những cú sốc bất ngờ (còn được gọi là innovations hoặc perturbations) lên một biến cụ thể đối với các biến khác trong mô hình được tóm lược. Trong phần này, chúng ta trình bày hai phương pháp phổ biến để tóm tắt các tác động của những ảnh hưởng nhân quả này: (1) hàm phản ứng xung, và (2) phân rã phương sai sai số dự báo.</p>
<section id="ham-phan-ung-xung-impulse-response-function-irf" class="tex2jax_process">
<h3 id="ham-phan-ung-xung-impulse-response-function-irf--12">Hàm phản ứng xung (Impulse Response Function - IRF)</h3>
<ul class="simple">
<li><p>Các hệ số của mô hình VAR thường rất khó để giải thích trực tiếp, vì vậy những người thực hành phân tích thường ước lượng hàm phản ứng xung.</p></li>
<li><p>IRF mô tả lại lộ trình thời gian về tác động của một cú sốc ngoại sinh từ một (hoặc nhiều) biến nội sinh lên một số hoặc tất cả các biến khác trong hệ thống VAR.</p></li>
<li><p>IRF vạch ra phản ứng của biến phụ thuộc trong hệ thống VAR đối với các cú sốc (còn được gọi là các đổi mới - innovations hoặc các xung lực - impulses) xảy ra trong các thành phần sai số.</p></li>
</ul>
<section id="irf-trong-he-var-cho-chat-luong-khong-khi" class="tex2jax_process">
<h4>IRF trong hệ VAR cho Chất lượng Không khí</h4>
<p class="tex2jax_process">Gọi <span class="math notranslate nohighlight tex2jax_process">\(y_{1,t}\)</span>, <span class="math notranslate nohighlight tex2jax_process">\(y_{2,t}\)</span> và <span class="math notranslate nohighlight tex2jax_process">\(y_{3,t}\)</span> lần lượt là các chuỗi thời gian tương ứng với tín hiệu CO, tín hiệu NO2 và tín hiệu RH. Xét dạng biểu diễn trung bình trượt của hệ thống được trình bày dưới đây:</p>
<p>Cho</p>
<img alt="images/irf_eq.png" src="images/irf_eq.png" style="max-width: 100%; height: auto; display: block;">
<p class="tex2jax_process">Giả sử <span class="math notranslate nohighlight tex2jax_process">\(u_1\)</span> trong phương trình thứ nhất tăng lên một giá trị bằng một độ lệch chuẩn.</p>
<ul class="simple tex2jax_process">
<li class="tex2jax_process"><p class="tex2jax_process">Cú sốc này sẽ làm thay đổi <span class="math notranslate nohighlight tex2jax_process">\(y_1\)</span> ở thời điểm hiện tại cũng như trong các thời kỳ tương lai.</p></li>
<li class="tex2jax_process"><p class="tex2jax_process">Cú sốc này cũng sẽ có tác động đến <span class="math notranslate nohighlight tex2jax_process">\(y_2\)</span> và <span class="math notranslate nohighlight tex2jax_process">\(y_3\)</span>.</p></li>
</ul>
<p class="tex2jax_process">Giả sử <span class="math notranslate nohighlight tex2jax_process">\(u_2\)</span> trong phương trình thứ hai tăng lên một giá trị bằng một độ lệch chuẩn.</p>
<ul class="simple tex2jax_process">
<li class="tex2jax_process"><p class="tex2jax_process">Cú sốc này sẽ làm thay đổi <span class="math notranslate nohighlight tex2jax_process">\(y_2\)</span> ở thời điểm hiện tại cũng như trong các thời kỳ tương lai.</p></li>
<li class="tex2jax_process"><p class="tex2jax_process">Cú sốc này cũng sẽ có tác động đến <span class="math notranslate nohighlight tex2jax_process">\(y_1\)</span> và <span class="math notranslate nohighlight tex2jax_process">\(y_3\)</span>.</p></li>
</ul>
<p class="tex2jax_process">Giả sử <span class="math notranslate nohighlight tex2jax_process">\(u_3\)</span> trong phương trình thứ ba tăng lên một giá trị bằng một độ lệch chuẩn.</p>
<ul class="simple tex2jax_process">
<li class="tex2jax_process"><p class="tex2jax_process">Cú sốc này sẽ làm thay đổi <span class="math notranslate nohighlight tex2jax_process">\(y_3\)</span> ở thời điểm hiện tại cũng như trong các thời kỳ tương lai.</p></li>
<li class="tex2jax_process"><p class="tex2jax_process">Cú sốc này cũng sẽ có tác động đến <span class="math notranslate nohighlight tex2jax_process">\(y_1\)</span> và <span class="math notranslate nohighlight tex2jax_process">\(y_2\)</span>.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">irf</span> <span class="o">=</span> <span class="n">var_model</span><span class="o">.</span><span class="n">irf</span><span class="p">(</span><span class="n">periods</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">irf</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">orth</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
              <span class="n">subplot_params</span><span class="o">=</span><span class="p">{</span><span class="s1">'fontsize'</span><span class="p">:</span> <span class="mi">10</span><span class="p">})</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="images/2c4b8ff0c53b794709eaa4de2ea993e6c4bf49ef01e4297319ecf27ad8c5a7c7.png" src="images/2c4b8ff0c53b794709eaa4de2ea993e6c4bf49ef01e4297319ecf27ad8c5a7c7.png" style="max-width: 100%; height: auto; display: block;">
</div>
</div>
<p><strong>Các quan sát:</strong></p>
<p><em>Tác động của nhiễu loạn/cú sốc ngoại sinh (1 độ lệch chuẩn) của một biến lên chính nó:</em></p>
<ul class="simple tex2jax_process">
<li class="tex2jax_process"><p class="tex2jax_process">CO <span class="math notranslate nohighlight tex2jax_process">\(\rightarrow\)</span> CO: Một cú sốc trong giá trị CO có tác động lớn hơn lên CO trong những giờ đầu, nhưng tác động này suy giảm dần theo thời gian.</p></li>
<li class="tex2jax_process"><p class="tex2jax_process">NO2 <span class="math notranslate nohighlight tex2jax_process">\(\rightarrow\)</span> NO2: Một cú sốc trong giá trị NO₂ có tác động lớn hơn lên NO₂ trong những giờ đầu, nhưng tác động này suy giảm dần theo thời gian.</p></li>
<li class="tex2jax_process"><p class="tex2jax_process">RH <span class="math notranslate nohighlight tex2jax_process">\(\rightarrow\)</span> RH: Một cú sốc trong giá trị RH có tác động lớn nhất lên RH sau 1 giờ, và tác động này suy giảm dần theo thời gian.</p></li>
</ul>
<p><em>Tác động của nhiễu loạn/cú sốc ngoại sinh của một biến lên biến khác:</em></p>
<ul class="simple tex2jax_process">
<li class="tex2jax_process"><p class="tex2jax_process">CO <span class="math notranslate nohighlight tex2jax_process">\(\rightarrow\)</span> NO2: Một cú sốc trong giá trị CO có tác động lớn nhất lên NO₂ sau 1 giờ, và tác động này suy giảm dần theo thời gian.</p></li>
<li class="tex2jax_process"><p class="tex2jax_process">CO <span class="math notranslate nohighlight tex2jax_process">\(\rightarrow\)</span> RH: Một cú sốc trong giá trị CO có tác động ngay lập tức lên giá trị RH. Tuy nhiên, tác động này giảm ngay sau 1 giờ, và giá trị có xu hướng ổn định quanh mức 0,2.</p></li>
<li class="tex2jax_process"><p class="tex2jax_process">NO2 <span class="math notranslate nohighlight tex2jax_process">\(\rightarrow\)</span> CO: Một cú sốc trong NO₂ chỉ gây ra tác động nhỏ lên các giá trị của CO. Dường như có một tác động trễ, đạt đỉnh sau 3 giờ, nhưng biên độ vẫn nhỏ.</p></li>
<li class="tex2jax_process"><p class="tex2jax_process">NO2 <span class="math notranslate nohighlight tex2jax_process">\(\rightarrow\)</span> RH: Một cú sốc trong NO₂ gây ra một tác động nhỏ (âm) lên các giá trị của RH. Biên độ dường như tiếp tục giảm sau 6 giờ. Giá trị của IRF đạt về 0 sau khoảng 7 giờ.</p></li>
<li class="tex2jax_process"><p class="tex2jax_process">RH <span class="math notranslate nohighlight tex2jax_process">\(\rightarrow\)</span> CO: Một cú sốc trong RH chỉ gây ra tác động nhỏ lên các giá trị của CO.</p></li>
<li class="tex2jax_process"><p class="tex2jax_process">RH <span class="math notranslate nohighlight tex2jax_process">\(\rightarrow\)</span> NO2: Một cú sốc trong giá trị RH có tác động lớn nhất lên NO₂ sau 1 giờ, và tác động này suy giảm dần theo thời gian. Giá trị của IRF đạt về 0 sau 6 giờ.</p></li>
</ul>
</section>
</section>
<section id="phan-ra-phuong-sai-sai-so-du-bao-forecast-error-variance-decomposition-fevd">
<h3 id="phan-ra-phuong-sai-sai-so-du-bao-forecast-error-va-13">Phân rã phương sai sai số dự báo (Forecast Error Variance Decomposition – FEVD)</h3>
<ul class="simple">
<li><p>FEVD cho biết mức độ thông tin mà mỗi biến đóng góp vào các biến khác trong mô hình tự hồi quy.</p></li>
<li><p>Trong khi hàm phản ứng xung (IRF) theo dõi tác động của một cú sốc lên một biến nội sinh đối với các biến khác trong mô hình VAR, thì phân rã phương sai tách sự biến động của một biến nội sinh thành các thành phần cú sốc trong mô hình VAR.</p></li>
<li><p>FEVD xác định bao nhiêu phần trăm phương sai của sai số dự báo của mỗi biến có thể được giải thích bởi các cú sốc ngoại sinh từ các biến khác.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fevd</span> <span class="o">=</span> <span class="n">var_model</span><span class="o">.</span><span class="n">fevd</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fevd</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="images/989ea9377365c918d7509ec36ff36a059356820b6380614c7492a68aa0744c1d.png" src="images/989ea9377365c918d7509ec36ff36a059356820b6380614c7492a68aa0744c1d.png" style="max-width: 100%; height: auto; display: block;">
</div>
</div>
<p><strong>Các quan át:</strong></p>
<ul class="simple">
<li><p>Đối với CO, phương sai chủ yếu được giải thích bởi các cú sốc ngoại sinh tác động lên chính CO. Mức độ này giảm dần theo thời gian nhưng chỉ với một lượng nhỏ.</p></li>
<li><p>Đối với NO₂, phương sai chủ yếu được giải thích bởi các cú sốc ngoại sinh tác động lên NO₂ và CO.</p></li>
<li><p>Đối với RH, phương sai chủ yếu được giải thích bởi các cú sốc ngoại sinh tác động lên RH. Theo thời gian, mức đóng góp của các cú sốc ngoại sinh từ CO tăng lên.</p></li>
</ul>
</section>
<section id="vi-du-3-du-bao-du-lieu-khi-hau-jena" class="tex2jax_process">
<h3 id="vi-du-3-du-bao-du-lieu-khi-hau-jena-14">Ví dụ 3: Dự báo dữ liệu khí hậu Jena</h3>
<p>Chúng ta tiến hành dự báo dữ liệu khí hậu Jena bằng phương pháp đã trình bày ở trên. Chúng ta sẽ huấn luyện mô hình VAR sử dụng các phép đo thời tiết theo giờ từ ngày 1 tháng 1 năm 2019 (00:10) đến ngày 29 tháng 12 năm 2014 (18:10). Hiệu năng của mô hình sẽ được đánh giá trên tập kiểm tra, bao gồm dữ liệu từ ngày 29 tháng 12 năm 2014 (19:10) đến ngày 31 tháng 12 năm 2014 (23:20), tương đương với 17.523 điểm dữ liệu cho mỗi biến.</p>
<section id="tai-bo-du-lieu">
<h4>Tải bộ dữ liệu</h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">train_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">'../data/train_series_datetime.csv'</span><span class="p">,</span><span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">'Date Time'</span><span class="p">)</span>
<span class="n">val_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">'../data/val_series_datetime.csv'</span><span class="p">,</span><span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">'Date Time'</span><span class="p">)</span>
<span class="n">test_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">'../data/test_series_datetime.csv'</span><span class="p">,</span><span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">'Date Time'</span><span class="p">)</span>
<span class="n">train_df</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">train_df</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
<span class="n">val_df</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">val_df</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
<span class="n">test_df</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">test_df</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">train_val_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">train_df</span><span class="p">,</span> <span class="n">val_df</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="kiem-tra-tinh-dung-cua-tung-bien-bang-kiem-dinh-adf">
<h4>Kiểm tra tính dừng của từng biến bằng kiểm định ADF</h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>
<span class="n">test_stat</span><span class="p">,</span> <span class="n">p_val</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
<span class="n">cv_1pct</span><span class="p">,</span> <span class="n">cv_5pct</span><span class="p">,</span> <span class="n">cv_10pct</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">train_val_df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span> 
    <span class="n">adf_res</span> <span class="o">=</span> <span class="n">adfuller</span><span class="p">(</span><span class="n">train_val_df</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">())</span>
    <span class="n">test_stat</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">adf_res</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">p_val</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">adf_res</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">cv_1pct</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">adf_res</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="s1">'1%'</span><span class="p">])</span>
    <span class="n">cv_5pct</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">adf_res</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="s1">'5%'</span><span class="p">])</span>
    <span class="n">cv_10pct</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">adf_res</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="s1">'10%'</span><span class="p">])</span>
<span class="n">adf_res_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">'Test statistic'</span><span class="p">:</span> <span class="n">test_stat</span><span class="p">,</span> 
                           <span class="s1">'p-value'</span><span class="p">:</span> <span class="n">p_val</span><span class="p">,</span> 
                           <span class="s1">'Critical value - 1%'</span><span class="p">:</span> <span class="n">cv_1pct</span><span class="p">,</span>
                           <span class="s1">'Critical value - 5%'</span><span class="p">:</span> <span class="n">cv_5pct</span><span class="p">,</span>
                           <span class="s1">'Critical value - 10%'</span><span class="p">:</span> <span class="n">cv_10pct</span><span class="p">},</span> 
                         <span class="n">index</span><span class="o">=</span><span class="n">train_df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
<span class="n">adf_res_df</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>CPU times: user 3min 11s, sys: 25.8 s, total: 3min 37s
Wall time: 57.2 s
</pre></div>
</div>
<div class="output text_html"><div>
<style>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<div class="table-container"><table class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>p (mbar)</th>
      <th>T (degC)</th>
      <th>Tpot (K)</th>
      <th>Tdew (degC)</th>
      <th>rh (%)</th>
      <th>VPmax (mbar)</th>
      <th>VPact (mbar)</th>
      <th>VPdef (mbar)</th>
      <th>sh (g/kg)</th>
      <th>H2OC (mmol/mol)</th>
      <th>rho (g/m**3)</th>
      <th>wv (m/s)</th>
      <th>max. wv (m/s)</th>
      <th>wd (deg)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Test statistic</th>
      <td>-15.5867</td>
      <td>-7.9586</td>
      <td>-8.3354</td>
      <td>-8.5750</td>
      <td>-17.7069</td>
      <td>-9.1945</td>
      <td>-9.0103</td>
      <td>-13.5492</td>
      <td>-9.0827</td>
      <td>-9.0709</td>
      <td>-9.3980</td>
      <td>-24.2424</td>
      <td>-24.3052</td>
      <td>-19.8394</td>
    </tr>
    <tr>
      <th>p-value</th>
      <td>0.0000</td>
      <td>0.0000</td>
      <td>0.0000</td>
      <td>0.0000</td>
      <td>0.0000</td>
      <td>0.0000</td>
      <td>0.0000</td>
      <td>0.0000</td>
      <td>0.0000</td>
      <td>0.0000</td>
      <td>0.0000</td>
      <td>0.0000</td>
      <td>0.0000</td>
      <td>0.0000</td>
    </tr>
    <tr>
      <th>Critical value - 1%</th>
      <td>-3.4305</td>
      <td>-3.4305</td>
      <td>-3.4305</td>
      <td>-3.4305</td>
      <td>-3.4305</td>
      <td>-3.4305</td>
      <td>-3.4305</td>
      <td>-3.4305</td>
      <td>-3.4305</td>
      <td>-3.4305</td>
      <td>-3.4305</td>
      <td>-3.4305</td>
      <td>-3.4305</td>
      <td>-3.4305</td>
    </tr>
    <tr>
      <th>Critical value - 5%</th>
      <td>-2.8616</td>
      <td>-2.8616</td>
      <td>-2.8616</td>
      <td>-2.8616</td>
      <td>-2.8616</td>
      <td>-2.8616</td>
      <td>-2.8616</td>
      <td>-2.8616</td>
      <td>-2.8616</td>
      <td>-2.8616</td>
      <td>-2.8616</td>
      <td>-2.8616</td>
      <td>-2.8616</td>
      <td>-2.8616</td>
    </tr>
    <tr>
      <th>Critical value - 10%</th>
      <td>-2.5668</td>
      <td>-2.5668</td>
      <td>-2.5668</td>
      <td>-2.5668</td>
      <td>-2.5668</td>
      <td>-2.5668</td>
      <td>-2.5668</td>
      <td>-2.5668</td>
      <td>-2.5668</td>
      <td>-2.5668</td>
      <td>-2.5668</td>
      <td>-2.5668</td>
      <td>-2.5668</td>
      <td>-2.5668</td>
    </tr>
  </tbody>
</table></div>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">((</span><span class="n">adf_res_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">'Test statistic'</span><span class="p">]</span><span class="o">&lt;</span> <span class="n">adf_res_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">'Critical value - 1%'</span><span class="p">])</span> <span class="o">&amp;</span> 
<span class="p">(</span><span class="n">adf_res_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">'Test statistic'</span><span class="p">]</span><span class="o">&lt;</span> <span class="n">adf_res_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">'Critical value - 5%'</span><span class="p">])</span> <span class="o">&amp;</span>
<span class="p">(</span> <span class="n">adf_res_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">'Test statistic'</span><span class="p">]</span><span class="o">&lt;</span> <span class="n">adf_res_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">'Critical value - 10%'</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>p (mbar)           True
T (degC)           True
Tpot (K)           True
Tdew (degC)        True
rh (%)             True
VPmax (mbar)       True
VPact (mbar)       True
VPdef (mbar)       True
sh (g/kg)          True
H2OC (mmol/mol)    True
rho (g/m**3)       True
wv (m/s)           True
max. wv (m/s)      True
wd (deg)           True
dtype: bool
</pre></div>
</div>
</div>
</div>
<p><strong>Các quan sát</strong>:</p>
<p>Từ các giá trị ở trên, tất cả các thành phần của dữ liệu khí hậu Jena đều là chuỗi dừng, do đó chúng ta sẽ sử dụng toàn bộ các biến trong mô hình VAR.</p>
</section>
<section id="chon-bac-p" class="tex2jax_process">
<h4>Chọn bậc p</h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>
<span class="n">aic</span><span class="p">,</span> <span class="n">bic</span><span class="p">,</span> <span class="n">fpe</span><span class="p">,</span> <span class="n">hqic</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">VAR</span><span class="p">(</span><span class="n">train_val_df</span><span class="p">)</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">60</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">p</span><span class="p">:</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="n">aic</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">aic</span><span class="p">)</span>
    <span class="n">bic</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">bic</span><span class="p">)</span>
    <span class="n">fpe</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">fpe</span><span class="p">)</span>
    <span class="n">hqic</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">hqic</span><span class="p">)</span>
<span class="n">lags_metrics_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">'AIC'</span><span class="p">:</span> <span class="n">aic</span><span class="p">,</span> 
                                <span class="s1">'BIC'</span><span class="p">:</span> <span class="n">bic</span><span class="p">,</span> 
                                <span class="s1">'HQIC'</span><span class="p">:</span> <span class="n">hqic</span><span class="p">,</span>
                                <span class="s1">'FPE'</span><span class="p">:</span> <span class="n">fpe</span><span class="p">},</span> 
                               <span class="n">index</span><span class="o">=</span><span class="n">p</span><span class="p">)</span>    
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">lags_metrics_df</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">subplots</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">'o'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>CPU times: user 2min 57s, sys: 14.3 s, total: 3min 11s
Wall time: 1min
</pre></div>
</div>
<img alt="images/efbc8ca4931c0b4f7fa42fa1ef503b410195d905062c65f5f79ad3005beb569e.png" src="images/efbc8ca4931c0b4f7fa42fa1ef503b410195d905062c65f5f79ad3005beb569e.png" style="max-width: 100%; height: auto; display: block;">
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lags_metrics_df</span><span class="o">.</span><span class="n">idxmin</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>AIC     51
BIC      5
HQIC    26
FPE     51
dtype: int64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lags_metrics_df</span><span class="p">[</span><span class="mi">25</span><span class="p">:]</span><span class="o">.</span><span class="n">idxmin</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>AIC     51
BIC     26
HQIC    26
FPE     51
dtype: int64
</pre></div>
</div>
</div>
</div>
<p><strong>Các quan sát</strong>:</p>
<p class="tex2jax_process">Bậc của mô hình cho giá trị nhỏ nhất khác nhau đối với từng tiêu chí thông tin, cho thấy không tồn tại một giá trị tối ưu rõ ràng. Chúng ta quan sát thấy một điểm “khuỷu tay” tại <span class="math notranslate nohighlight tex2jax_process">\(p=5\)</span>, Bậc của mô hình cho giá trị nhỏ nhất khác nhau đối với từng tiêu chí thông tin, cho thấy không tồn tại một giá trị tối ưu rõ ràng. Chúng ta quan sát thấy một điểm “khuỷu tay” tại <span class="math notranslate nohighlight tex2jax_process">\(p=26\)</span>. Do đó, chúng ta lựa chọn <span class="math notranslate nohighlight tex2jax_process">\(p=26\)</span> làm độ trễ của mô hình.</p>
</section>
<section id="huan-luyen-mo-hinh-var-su-dung-du-lieu-huan-luyen-va-du-lieu-kiem-dinh">
<h4>Huấn luyện mô hình VAR sử dụng dữ liệu huấn luyện và dữ liệu kiểm định</h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>
<span class="n">var_model</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="mi">26</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>CPU times: user 1.38 s, sys: 151 ms, total: 1.53 s
Wall time: 631 ms
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">test_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">test_df</span><span class="p">)</span><span class="o">-</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">test_df</span><span class="p">))</span><span class="o">%</span><span class="k">24</span>).reshape((-1, 24))
<span class="n">fit_index</span> <span class="o">=</span> <span class="p">[</span><span class="n">test_index</span><span class="p">[:</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">test_index</span><span class="p">))]</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="du-bao-cac-phep-do-thoi-tiet-trong-24-gio-va-danh-gia-hieu-nang-tren-tap-kiem-tra">
<h4>Dự báo các phép đo thời tiết trong 24 giờ và đánh giá hiệu năng trên tập kiểm tra</h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">forecasts_df</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">fit_index</span><span class="p">)):</span>
    <span class="n">forecast_var</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">var_model</span><span class="o">.</span><span class="n">forecast</span><span class="p">(</span>
        <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">train_val_df</span><span class="p">,</span> <span class="n">test_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">fit_index</span><span class="p">[</span><span class="n">n</span><span class="p">]]])</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">steps</span><span class="o">=</span><span class="mi">24</span><span class="p">),</span> 
                                <span class="n">columns</span><span class="o">=</span><span class="n">train_val_df</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> 
                                <span class="n">index</span><span class="o">=</span><span class="n">test_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">test_index</span><span class="p">[</span><span class="n">n</span><span class="p">]]</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
    <span class="n">forecasts_df</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">forecast_var</span><span class="p">)</span>
<span class="n">forecasts_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">forecasts_df</span><span class="p">)</span>
<span class="n">forecasts_df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">forecasts_df</span><span class="o">.</span><span class="n">columns</span><span class="o">+</span><span class="p">[</span><span class="s1">'-VAR'</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">train_val_df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">14</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
    <span class="n">train_val_df</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
    <span class="n">forecasts_df</span><span class="p">[[</span><span class="n">c</span><span class="o">+</span><span class="s1">'-VAR'</span><span class="p">]]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="n">train_val_df</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">train_val_df</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="images/f46114c1f57dbfcf1838cba0ea43a1f232c0deb9c3fd5c2cd481f5b33a41b245.png" src="images/f46114c1f57dbfcf1838cba0ea43a1f232c0deb9c3fd5c2cd481f5b33a41b245.png" style="max-width: 100%; height: auto; display: block;">
<img alt="images/0849c4261ba57943c743f383f54595c110beb96d5c02146f104b7e1532e81875.png" src="images/0849c4261ba57943c743f383f54595c110beb96d5c02146f104b7e1532e81875.png" style="max-width: 100%; height: auto; display: block;">
<img alt="images/c0d1266b44209645c737f07fbe8a7f0448f3473cd3f797b1e90fd338c8183c93.png" src="images/c0d1266b44209645c737f07fbe8a7f0448f3473cd3f797b1e90fd338c8183c93.png" style="max-width: 100%; height: auto; display: block;">
<img alt="images/8aeab87dff409e39ce7e0ae81811bc53f7e2cf2640dd526cb0ef8c346d9d10f8.png" src="images/8aeab87dff409e39ce7e0ae81811bc53f7e2cf2640dd526cb0ef8c346d9d10f8.png" style="max-width: 100%; height: auto; display: block;">
<img alt="images/2a9fe33faf78f648d27f8bfaf325649d42a0ec3a679d12d1bbf7cca3a5719929.png" src="images/2a9fe33faf78f648d27f8bfaf325649d42a0ec3a679d12d1bbf7cca3a5719929.png" style="max-width: 100%; height: auto; display: block;">
<img alt="images/da0d11e4d31f1cfb9d5c01e2171cec4f74dcadfb5218a6a8c2d07518568aca22.png" src="images/da0d11e4d31f1cfb9d5c01e2171cec4f74dcadfb5218a6a8c2d07518568aca22.png" style="max-width: 100%; height: auto; display: block;">
<img alt="images/716f2a09ec92e466b6c46210d227a2ecd0707ddfa75a0ab13a9c9710b8434d31.png" src="images/716f2a09ec92e466b6c46210d227a2ecd0707ddfa75a0ab13a9c9710b8434d31.png" style="max-width: 100%; height: auto; display: block;">
<img alt="images/1881eb7f18205db0206f2de05a128f2eed4089fef347b39a13d3d7e80e820999.png" src="images/1881eb7f18205db0206f2de05a128f2eed4089fef347b39a13d3d7e80e820999.png" style="max-width: 100%; height: auto; display: block;">
<img alt="images/92f912ad3e77c307ff0a55a24fde4e435c00282ed0decaafef9a1344d379209c.png" src="images/92f912ad3e77c307ff0a55a24fde4e435c00282ed0decaafef9a1344d379209c.png" style="max-width: 100%; height: auto; display: block;">
<img alt="images/5a0d53063abfdbf6818eff7eff90a245ddabad23b9b2c956c027a3a126472452.png" src="images/5a0d53063abfdbf6818eff7eff90a245ddabad23b9b2c956c027a3a126472452.png" style="max-width: 100%; height: auto; display: block;">
<img alt="images/e070449c192e5d2147d4351524388ad2afdeb09a885d0f2474534a770510a681.png" src="images/e070449c192e5d2147d4351524388ad2afdeb09a885d0f2474534a770510a681.png" style="max-width: 100%; height: auto; display: block;">
<img alt="images/cc94bb9c972482cfe127037ceb891a58a30601f80589a8ad20319db5bbd4e731.png" src="images/cc94bb9c972482cfe127037ceb891a58a30601f80589a8ad20319db5bbd4e731.png" style="max-width: 100%; height: auto; display: block;">
<img alt="images/8e6ca09cc08e4d1f4df5196577fcbce1a50071d6ee516bb24f62d9e946bab502.png" src="images/8e6ca09cc08e4d1f4df5196577fcbce1a50071d6ee516bb24f62d9e946bab502.png" style="max-width: 100%; height: auto; display: block;">
<img alt="images/c0e2fc7683d4bbe3d24d18a93f71ccc01ac23b79d634b2b14b2061e0646f1ed1.png" src="images/c0e2fc7683d4bbe3d24d18a93f71ccc01ac23b79d634b2b14b2061e0646f1ed1.png" style="max-width: 100%; height: auto; display: block;">
</div>
</div>
<p><em><strong>Đánh giá kết quả dự báo</strong></em></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">utils</span><span class="o">.</span><span class="n">test_performance_metrics</span><span class="p">(</span><span class="n">test_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">forecasts_df</span><span class="o">.</span><span class="n">index</span><span class="p">],</span> <span class="n">forecasts_df</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="s1">'-VAR'</span><span class="p">)</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="s1">'MAE'</span><span class="p">,</span> <span class="s1">'MSE'</span><span class="p">]]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<div class="table-container"><table class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>p (mbar)-VAR</th>
      <th>T (degC)-VAR</th>
      <th>Tpot (K)-VAR</th>
      <th>Tdew (degC)-VAR</th>
      <th>rh (%)-VAR</th>
      <th>VPmax (mbar)-VAR</th>
      <th>VPact (mbar)-VAR</th>
      <th>VPdef (mbar)-VAR</th>
      <th>sh (g/kg)-VAR</th>
      <th>H2OC (mmol/mol)-VAR</th>
      <th>rho (g/m**3)-VAR</th>
      <th>wv (m/s)-VAR</th>
      <th>max. wv (m/s)-VAR</th>
      <th>wd (deg)-VAR</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>MAE</th>
      <td>2.681284</td>
      <td>2.542025</td>
      <td>2.603187</td>
      <td>1.797102</td>
      <td>10.899944</td>
      <td>2.526237</td>
      <td>1.171625</td>
      <td>2.379343</td>
      <td>0.744665</td>
      <td>1.186948</td>
      <td>12.164486</td>
      <td>3.136091</td>
      <td>4.414089</td>
      <td>66.420597</td>
    </tr>
    <tr>
      <th>MSE</th>
      <td>238.321753</td>
      <td>652.733627</td>
      <td>618.458262</td>
      <td>102.257346</td>
      <td>9581.665059</td>
      <td>540.666240</td>
      <td>39.837241</td>
      <td>490.874048</td>
      <td>15.612470</td>
      <td>39.678736</td>
      <td>9986.126326</td>
      <td>17352.964659</td>
      <td>23404.318476</td>
      <td>87581.698748</td>
    </tr>
  </tbody>
</table></div>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">T_MAEs</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">test_index</span><span class="p">)):</span>
    <span class="n">index</span> <span class="o">=</span> <span class="n">forecasts_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">test_index</span><span class="p">[</span><span class="n">n</span><span class="p">]]</span><span class="o">.</span><span class="n">index</span>
    <span class="n">T_MAEs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">test_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">'T (degC)'</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> 
                                            <span class="n">forecasts_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">'T (degC)-VAR'</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">'VAR(26) MAE: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">T_MAEs</span><span class="p">)</span><span class="si">}</span><span class="s1">'</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>VAR(26) MAE: 2.5420250169753875
</pre></div>
</div>
</div>
</div>
<p><strong>Các quan sát</strong>: Mô hình VAR(26) cho kết quả tốt hơn các mô hình <a class="reference internal" href="../08_WinningestMethods/lightgbm_jena_forecasting.html"><span class="doc std std-doc">naive (MAE= 3.18), seasonal naive (MAE= 2.61)</span></a> và <a class="reference internal" href="../01_AutoRegressiveIntegratedMovingAverage/01_AutoRegressiveIntegratedMovingAverage.html"><span class="doc std std-doc">ARIMA (MAE= 3.19)</span></a>.</p>
</section>
<section id="du-bao-24-gio-tiep-theo-vuot-ngoai-tap-kiem-tra">
<h4>Dự báo 24 giờ tiếp theo vượt ngoài tập kiểm tra</h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">all_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">train_df</span><span class="p">,</span> <span class="n">val_df</span><span class="p">,</span> <span class="n">test_df</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">future_index</span> <span class="o">=</span> <span class="p">[</span><span class="n">all_data</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">(</span><span class="sa">f</span><span class="s1">'</span><span class="si">{</span><span class="n">h</span><span class="si">}</span><span class="s1"> hour'</span><span class="p">)</span> <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">24</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">forecast_var_future</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">var_model</span><span class="o">.</span><span class="n">forecast</span><span class="p">(</span><span class="n">all_data</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> 
                                                      <span class="n">steps</span><span class="o">=</span><span class="mi">24</span><span class="p">),</span> 
                                   <span class="n">columns</span><span class="o">=</span><span class="n">all_data</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> 
                                   <span class="n">index</span><span class="o">=</span><span class="n">future_index</span><span class="p">)</span>

<span class="n">forecast_var_future</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">forecast_var_future</span><span class="o">.</span><span class="n">columns</span><span class="o">+</span><span class="p">[</span><span class="s1">'-VAR'</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">train_val_df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">14</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
    <span class="n">all_data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">500</span><span class="p">:][</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
    <span class="n">forecast_var_future</span><span class="p">[[</span><span class="n">c</span><span class="o">+</span><span class="s1">'-VAR'</span><span class="p">]]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="n">train_val_df</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">train_val_df</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="images/d98cb3e525f41b28fd7eca4b56e71a861cf32e52ce2a8487307de717e6674edc.png" src="images/d98cb3e525f41b28fd7eca4b56e71a861cf32e52ce2a8487307de717e6674edc.png" style="max-width: 100%; height: auto; display: block;">
<img alt="images/b776761fb903cdf05084d76b415335dbb2798a245e62b0dc4c86f771dc3c7fc2.png" src="images/b776761fb903cdf05084d76b415335dbb2798a245e62b0dc4c86f771dc3c7fc2.png" style="max-width: 100%; height: auto; display: block;">
<img alt="images/536816f9fb3310476dc67c85451ba2c6fe7947e6dafdd94597991946d8851879.png" src="images/536816f9fb3310476dc67c85451ba2c6fe7947e6dafdd94597991946d8851879.png" style="max-width: 100%; height: auto; display: block;">
<img alt="images/f5f89fbbde608d40041684651ce1c8d5c4bd72e83e60720d56dd0902af12abe3.png" src="images/f5f89fbbde608d40041684651ce1c8d5c4bd72e83e60720d56dd0902af12abe3.png" style="max-width: 100%; height: auto; display: block;">
<img alt="images/2e74cd01092df5a3b692a6e6f8662d7e6f87507ef378290365a86746910e8142.png" src="images/2e74cd01092df5a3b692a6e6f8662d7e6f87507ef378290365a86746910e8142.png" style="max-width: 100%; height: auto; display: block;">
<img alt="images/edc4743b4f6d558de9369a1042ea02f7f898442f16cec4c3a68e8d7848f97dfa.png" src="images/edc4743b4f6d558de9369a1042ea02f7f898442f16cec4c3a68e8d7848f97dfa.png" style="max-width: 100%; height: auto; display: block;">
<img alt="images/93fad15655c5f6c5101f02fde4319091287100b02f2252e89b7c0213b38e4d86.png" src="images/93fad15655c5f6c5101f02fde4319091287100b02f2252e89b7c0213b38e4d86.png" style="max-width: 100%; height: auto; display: block;">
<img alt="images/92699457f13adc6b06ea5e6519450024dd0e7cc7a0db480e15c3247dea8bdbba.png" src="images/92699457f13adc6b06ea5e6519450024dd0e7cc7a0db480e15c3247dea8bdbba.png" style="max-width: 100%; height: auto; display: block;">
<img alt="images/ce7a25d39e77bbbd39e38a0e0cf5d59cda9e8fe949e9e2c9f4a2a17fd7f4a147.png" src="images/ce7a25d39e77bbbd39e38a0e0cf5d59cda9e8fe949e9e2c9f4a2a17fd7f4a147.png" style="max-width: 100%; height: auto; display: block;">
<img alt="images/d568618ac0f1430d0207f2262b947a25be0d410caf2b8575b0511a9edb1340c6.png" src="images/d568618ac0f1430d0207f2262b947a25be0d410caf2b8575b0511a9edb1340c6.png" style="max-width: 100%; height: auto; display: block;">
<img alt="images/b15c5f8fba857b98e885fc9a6656626f959c67b190d627bfb203deed4b1b3345.png" src="images/b15c5f8fba857b98e885fc9a6656626f959c67b190d627bfb203deed4b1b3345.png" style="max-width: 100%; height: auto; display: block;">
<img alt="images/4a18879f8808a07946befcddde0158687bd4a71a88dc7da0979d35555b2210b9.png" src="images/4a18879f8808a07946befcddde0158687bd4a71a88dc7da0979d35555b2210b9.png" style="max-width: 100%; height: auto; display: block;">
<img alt="images/5fddb6c38802ca4f3785f111893248021aab77ee12af19e502d42049054b4a3f.png" src="images/5fddb6c38802ca4f3785f111893248021aab77ee12af19e502d42049054b4a3f.png" style="max-width: 100%; height: auto; display: block;">
<img alt="images/50862604aebdd99bd1d0a101780c2fe5751359fea51bbe3753dcfb2980747967.png" src="images/50862604aebdd99bd1d0a101780c2fe5751359fea51bbe3753dcfb2980747967.png" style="max-width: 100%; height: auto; display: block;">
</div>
</div>
</section>
</section>
</section>

</section>
    </article>
    
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const fixRawMath = () => {
        if (window.MathJax && window.MathJax.typeset) {
            window.MathJax.typeset();
        }
      };
      setTimeout(fixRawMath, 1000);

      document.querySelectorAll('a[href^="#"]').forEach(anchor => {
          anchor.addEventListener('click', function (e) {
              const href = this.getAttribute('href');
              if (href === '#' || !href.startsWith('#')) return;
              e.preventDefault();
              const targetId = href.slice(1);
              const targetElement = document.getElementById(targetId);
              if (targetElement) {
                  window.scrollTo({
                      top: targetElement.offsetTop - 40,
                      behavior: 'smooth'
                  });
              }
          });
      });
    });
  </script>

</body>
</html>